<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9 SIG BN Management System</title>
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --bg-sidebar: rgba(20, 20, 20, 0.4);
            --bg-card: rgba(30, 30, 30, 0.4);
            --accent-color: #00e5ff;
            --accent-glow: rgba(0, 229, 255, 0.4);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --danger: #ff4d4d;
            --success: #00ff88;
            --border-color: rgba(255, 255, 255, 0.1);
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .bg-mesh {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 10% 20%, rgba(0, 229, 255, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(138, 43, 226, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(0, 0, 0, 1) 100%, transparent 0%);
            z-index: -1;
            animation: pulseBg 10s infinite alternate;
        }

        @keyframes pulseBg {
            0% {
                opacity: 0.8;
                transform: scale(1);
            }

            100% {
                opacity: 1;
                transform: scale(1.05);
            }
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 260px;
            background: var(--bg-sidebar);
            border-right: var(--glass-border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            padding: 30px 20px;
            z-index: 10;
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .sidebar-header {
            margin-bottom: 50px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: none;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--accent-color);
            font-weight: 800;
            letter-spacing: 1px;
            text-shadow: 0 0 20px var(--accent-glow);
        }

        .logo i {
            font-size: 1.8rem;
            filter: drop-shadow(0 0 10px var(--accent-color));
        }

        .logo span {
            font-size: 1.6rem;
            color: var(--accent-color);
        }

        .sidebar-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 0;
        }

        .sidebar-nav ul {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .sidebar-nav li {
            padding: 15px 20px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .sidebar-nav li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, rgba(0, 229, 255, 0.1), transparent);
            transition: width 0.3s ease;
        }

        .sidebar-nav li:hover {
            background: transparent;
            color: white;
            padding-left: 30px;
        }

        .sidebar-nav li:hover::before {
            width: 100%;
        }

        .sidebar-nav li.active {
            background: linear-gradient(90deg, rgba(0, 229, 255, 0.15), transparent);
            color: var(--accent-color);
            border-left: 3px solid var(--accent-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 30px 50px;
            overflow-y: auto;
        }

        .topbar {
            height: auto;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0;
            margin-bottom: 30px;
            border-bottom: none;
        }

        .alert-pulse {
            animation: alertPulse 2s infinite;
        }

        @keyframes alertPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(231, 76, 60, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }

        .search-bar {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 50px;
            padding: 12px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .search-bar:focus-within {
            border-color: var(--accent-color);
            box-shadow: 0 0 20px var(--accent-glow);
            background: rgba(255, 255, 255, 0.05);
        }

        .search-bar i {
            position: static;
            transform: none;
            color: var(--text-secondary);
        }

        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            outline: none;
            width: 100%;
            font-size: 1rem;
            padding: 0;
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .btn-notification {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 45px;
            height: 45px;
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .btn-notification:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .btn-notification .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.65rem;
            font-weight: 800;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-dark);
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            text-align: right;
        }

        .user-name {
            font-weight: 500;
            font-size: 0.95rem;
        }

        .user-rank {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid var(--accent-color);
        }

        .content-area {
            padding: 40px;
            flex: 1;
        }

        /* Dashboard Loading */
        .dashboard-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-family: sans-serif;
            color: var(--accent-color);
            letter-spacing: 3px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.5;
            }
        }

        .dashboard-header {
            margin-bottom: 40px;
        }

        .dashboard-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: -1px;
            background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dashboard-header p {
            color: var(--text-secondary);
            font-size: 1rem;
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 24px;
            border: var(--glass-border);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            gap: 25px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), transparent);
            pointer-events: none;
        }

        .stat-card:hover {
            transform: translateY(-10px);
            border-color: var(--accent-color);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 20px var(--accent-glow);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: var(--accent-color);
            border: 1px solid rgba(0, 229, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.1);
        }

        .stat-info h3 {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-info .value {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .dashboard-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }

        .panel {
            background: var(--bg-card);
            border-radius: 20px;
            border: var(--glass-border);
            backdrop-filter: blur(15px);
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .panel-header {
            padding: 25px;
            border-bottom: var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.02);
        }

        .panel-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-link {
            background: rgba(0, 229, 255, 0.1);
            border: 1px solid rgba(0, 229, 255, 0.2);
            color: var(--accent-color);
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-link:hover {
            background: var(--accent-color);
            color: #000;
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            border-bottom: var(--glass-border);
            background: rgba(255, 255, 255, 0.01);
        }

        .data-table td {
            padding: 20px;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            transition: background 0.2s;
        }

        .data-table tr:hover td {
            background: rgba(255, 255, 255, 0.03);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-badge.active {
            background: rgba(231, 76, 60, 0.1);
            color: #ff4757;
            border: 1px solid rgba(231, 76, 60, 0.2);
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.1);
        }

        .status-badge.completed {
            background: rgba(46, 213, 115, 0.1);
            color: #2ed573;
            border: 1px solid rgba(46, 213, 115, 0.2);
        }

        .alert-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 16px;
            margin-bottom: 15px;
            border: var(--glass-border);
            transition: all 0.3s;
        }

        .alert-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: scale(1.02);
        }

        .alert-item.high {
            border-left: 4px solid var(--danger);
            box-shadow: -10px 0 20px rgba(255, 77, 77, 0.05);
        }

        .alert-item.mid {
            border-left: 4px solid #f1c40f;
        }

        .stat-card.active-filter {
            border-color: var(--accent-color);
            background: rgba(0, 229, 255, 0.05);
            box-shadow: 0 0 20px var(--accent-glow), inset 0 0 10px var(--accent-glow);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color) 0%, #00bfdb 100%);
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 20px rgba(0, 229, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 30px var(--accent-glow);
            background: linear-gradient(135deg, #00ffea 0%, #00e5ff 100%);
        }

        /* Post Management Styles */
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .post-card {
            background: var(--bg-card);
            border-radius: 20px;
            border: var(--glass-border);
            padding: 25px;
            backdrop-filter: blur(15px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .post-card:hover {
            transform: translateY(-10px);
            border-color: var(--accent-color);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), 0 0 15px var(--accent-glow);
        }

        .post-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }

        .post-id {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-family: sans-serif;
        }

        .post-assignments {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .assignment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.03);
            padding: 10px;
            border-radius: 8px;
            border-left: 2px solid var(--accent-color);
        }

        .assignee-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .assignee-rank {
            font-size: 0.7rem;
            color: var(--accent-color);
            text-transform: uppercase;
        }

        .assignee-name {
            font-weight: 500;
        }

        .remove-assignment {
            color: #e74c3c;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .assign-btn {
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            color: var(--text-secondary);
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .assign-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            background: rgba(0, 229, 255, 0.05);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .delete-post {
            color: #e74c3c;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .delete-post:hover {
            transform: scale(1.2);
        }

        /* Modal/Form Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: rgba(30, 30, 30, 0.8);
            width: 500px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 30px rgba(0, 229, 255, 0.05);
            backdrop-filter: blur(20px);
            position: relative;
        }

        .modal-content h2 {
            margin-bottom: 30px;
            font-weight: 800;
            color: white;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-content h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--accent-color);
            border-radius: 2px;
            box-shadow: 0 0 10px var(--accent-glow);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 0.95rem;
            outline: none;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .personnel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .personnel-card {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: var(--transition);
            position: relative;
        }

        .personnel-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: var(--card-shadow);
        }

        .personnel-card .card-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid var(--accent-color);
            margin-bottom: 15px;
            object-fit: cover;
        }

        .personnel-card .card-rank {
            color: var(--accent-color);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .personnel-card .card-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .personnel-card .card-info {
            width: 100%;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.85rem;
            text-align: left;
        }

        .personnel-card .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .personnel-card .info-row:last-child {
            margin-bottom: 0;
        }

        .personnel-card .info-label {
            color: var(--text-secondary);
        }

        .personnel-card .card-actions {
            display: flex;
            gap: 15px;
            margin-top: auto;
        }

        .view-mode-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .view-mode-btn.active {
            background: var(--accent-color);
            color: #000;
            border-color: var(--accent-color);
        }

        /* Vehicle Management Styles */
        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .vehicle-card {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: var(--card-shadow);
        }

        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .vehicle-icon {
            width: 50px;
            height: 50px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        .vehicle-info h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .vehicle-type {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .maintenance-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .maintenance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .maintenance-item.alert {
            background: rgba(231, 76, 60, 0.15);
            border-left: 3px solid #e74c3c;
            color: #ffadad;
        }

        .maintenance-item.warning {
            border-left: 3px solid #f1c40f;
        }

        .maintenance-label {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .maintenance-status {
            font-weight: 600;
        }

        .vehicle-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: var(--accent-color);
            color: #000;
        }

        .km-badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-family: monospace;
            margin-left: auto;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="bg-mesh"></div>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header" onclick="app.setPage('vehicles')" style="cursor:pointer;">
                <div class="logo">
                    <div class="logo-icon"><i class="fas fa-truck-moving"></i></div>
                    <span>9 SIG BN</span>
                </div>
            </div>
            <ul class="sidebar-nav">
                <li onclick="app.setPage('vehicles')" data-tab="vehicles" class="active">
                    <i class="fas fa-truck-moving"></i>
                    <span>Management</span>
                </li>
                <li onclick="app.setPage('dashboard')" data-tab="dashboard">
                    <i class="fas fa-chart-pie"></i>
                    <span>Overview</span>
                </li>
                <li onclick="app.setPage('person')" data-tab="person">
                    <i class="fas fa-id-badge"></i>
                    <span>Personnel Registry</span>
                </li>
                <li onclick="app.setPage('posts')" data-tab="posts">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>Duty List</span>
                </li>
                <li onclick="app.setPage('roster')" data-tab="roster">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Duty Roster</span>
                </li>
                <li onclick="app.setPage('reports')" data-tab="reports">
                    <i class="fas fa-file-signature"></i>
                    <span>Reports</span>
                </li>
                <li onclick="app.setPage('settings')" data-tab="settings">
                    <i class="fas fa-sliders-h"></i>
                    <span>System Config</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <div class="user-status">
                    <div class="status-indicator online"></div>
                    <span>System Online</span>
                </div>
            </div>
        </div>

        <!-- Main Content area -->
        <div class="main-content">
            <div class="topbar" style="display: none;">
                <!-- Topbar hidden per user request to clean up UI -->
            </div>

            <div id="content-area" class="content-area">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>

    <script>
        const app = {
            // Firebase Configuration
            DB_URL: "https://neo100-89aba-default-rtdb.asia-southeast1.firebasedatabase.app/9SIGBN.json",

            // Initial State (Default values for offline/fast load)
            posts: [],
            assignments: [],
            personnel: [],
            vehicles: [],
            vehicleTypes: ["Jeep", "Pickup", "3-Ton", "Motorcycle", "Hiace", "Coaster Bus"],
            vehicleCategories: {
                "Light Vehicle": ["Jeep", "Pickup", "Hiace"],
                "Heavy Vehicle": ["3-Ton", "Coaster Bus"],
                "Motorcycle": ["Motorcycle"]
            },
            professions: ["Technician", "Operator", "Driver Signal", "Clerk", "SMT Clerk"],
            sections: ["BHQ COY", "HQ COY", "RDO COY", "RR COY", "OP COY", "108 COY", "109 COY", "RP", "MT"],
            unitsData: { "9 SIG BN": [], "Army Camp": ["Narsindi Camp", "Sippur Camp"] },

            // Filter State
            currentPersonnelFilter: 'All',
            currentUnitFilter: 'All',
            currentRankFilter: 'All',
            currentDutyFilter: 'All',
            currentDutyCategory: 'All',
            currentVehicleCategoryFilter: 'All',
            currentVehicleTypeFilter: 'All',
            currentVehicleCompanyFilter: 'All',
            vehicleSearchQuery: '',
            personnelSearchQuery: '',
            vehicleStatusFilter: 'All',
            selectedVehicleId: null,
            vehicleViewMode: 'grid', // 'grid' or 'list'

            // GitHub Config (Backup)
            githubToken: localStorage.getItem('github_token') || '',
            githubOwner: localStorage.getItem('github_owner') || '',
            githubRepo: localStorage.getItem('github_repo') || '',
            githubPath: localStorage.getItem('github_path') || 'army_data.json',

            init() {
                this.cacheDOM();
                this.bindEvents();
                this.loadData(); // Load from Firebase
            },

            setMaintenanceDate(selectId, dateId) {
                const months = document.getElementById(selectId).value;
                if (!months) return;
                const date = new Date();
                date.setMonth(date.getMonth() + parseInt(months));
                document.getElementById(dateId).value = date.toISOString().split('T')[0];
            },

            updateVehicleTypeOptions() {
                const category = document.getElementById('v-category').value;
                const typeSelect = document.getElementById('v-type');
                typeSelect.innerHTML = '';

                if (category && this.vehicleCategories[category]) {
                    this.vehicleCategories[category].forEach(type => {
                        const opt = document.createElement('option');
                        opt.value = type;
                        opt.textContent = type;
                        typeSelect.appendChild(opt);
                    });
                } else {
                    const opt = document.createElement('option');
                    opt.value = "";
                    opt.textContent = "Select Category First";
                    typeSelect.appendChild(opt);
                }
            },

            updateEditVehicleTypeOptions(selectedType = null) {
                const category = document.getElementById('edit-v-category').value;
                const typeSelect = document.getElementById('edit-v-type');
                typeSelect.innerHTML = '';

                if (category && this.vehicleCategories[category]) {
                    this.vehicleCategories[category].forEach(type => {
                        const opt = document.createElement('option');
                        opt.value = type;
                        opt.textContent = type;
                        if (type === selectedType) opt.selected = true;
                        typeSelect.appendChild(opt);
                    });
                }
            },

            cacheDOM() {
                this.navItems = document.querySelectorAll('.sidebar-nav li');
                this.contentArea = document.getElementById('content-area');
            },

            bindEvents() {
                this.navItems.forEach(item => {
                    item.addEventListener('click', (e) => this.handleTabSwitch(e));
                });

                document.addEventListener('click', (e) => {
                    if (e.target.closest('.delete-post')) {
                        const postId = e.target.closest('.post-card').dataset.id;
                        this.deletePost(postId);
                    }
                    if (e.target.closest('.assign-btn')) {
                        const postId = e.target.closest('.post-card').dataset.id;
                        this.showAssignModal(postId);
                    }
                    if (e.target.closest('.remove-assignment')) {
                        const assignmentId = parseInt(e.target.closest('.remove-assignment').dataset.id);
                        this.removeAssignment(assignmentId);
                    }
                    if (e.target.closest('.delete-person')) {
                        const personId = e.target.closest('.delete-person').dataset.id;
                        this.deleteSoldier(personId);
                    }
                    if (e.target.closest('.edit-person')) {
                        const personId = e.target.closest('.edit-person').dataset.id;
                        this.showEditSoldierModal(personId);
                    }
                    if (e.target.closest('.view-person')) {
                        const personId = e.target.closest('.view-person').dataset.id;
                        this.showViewSoldierModal(personId);
                    }
                });
            },

            safeArray(input, fallback = []) {
                if (!input) return fallback;
                if (Array.isArray(input)) return input.filter(x => x !== null && x !== undefined);
                if (typeof input === 'object') return Object.values(input);
                return fallback;
            },

            async loadData() {
                try {
                    const response = await fetch(this.DB_URL);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();

                    if (data) {
                        this.posts = this.safeArray(data.posts);
                        this.assignments = this.safeArray(data.assignments);
                        this.personnel = this.safeArray(data.personnel);
                        this.vehicles = this.safeArray(data.vehicles);

                        // Use defaults if empty or invalid
                        this.professions = this.safeArray(data.professions);
                        if (this.professions.length === 0) this.professions = ["Technician", "Operator", "Driver Signal", "Clerk", "SMT Clerk"];

                        this.sections = this.safeArray(data.sections);
                        if (this.sections.length === 0) this.sections = ["BHQ COY", "HQ COY", "RDO COY", "RR COY", "OP COY", "108 COY", "109 COY", "RP", "MT"];

                        this.unitsData = data.unitsData || {};
                        // Fix: If unitsData is empty or not an object, restore defaults
                        if (!this.unitsData || typeof this.unitsData !== 'object' || Object.keys(this.unitsData).length === 0) {
                            this.unitsData = { "9 SIG BN": [], "Army Camp": ["Narsindi Camp", "Sippur Camp"] };
                        }
                        // Ensure 9 SIG BN always exists
                        if (!this.unitsData["9 SIG BN"]) {
                            this.unitsData["9 SIG BN"] = [];
                        }
                    } else {
                        // Initialize if DB is empty
                        this.saveData();
                    }
                    this.setPage('vehicles');
                } catch (error) {
                    console.error("Error loading data from Firebase:", error);
                    alert("Failed to connect to Tactical Database (Firebase). Working offline.");
                    // Ensure defaults exist even offline
                    if (this.professions.length === 0) this.professions = ["Technician", "Operator", "Driver Signal", "Clerk", "SMT Clerk"];
                    if (this.sections.length === 0) this.sections = ["BHQ COY", "HQ COY", "RDO COY", "RR COY", "OP COY", "108 COY", "109 COY", "RP", "MT"];
                    if (Object.keys(this.unitsData).length === 0) this.unitsData = { "9 SIG BN": [], "Army Camp": ["Narsindi Camp", "Sippur Camp"] };
                    this.setPage('vehicles');
                }
            },

            async saveData() {
                const dataToSave = {
                    posts: this.posts,
                    assignments: this.assignments,
                    personnel: this.personnel,
                    vehicles: this.vehicles,
                    professions: this.professions,
                    sections: this.sections,
                    unitsData: this.unitsData
                };

                try {
                    await fetch(this.DB_URL, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(dataToSave),
                    });
                } catch (error) {
                    console.error("Error saving data to Firebase:", error);
                }
            },

            renderDashboard() {
                const totalVehicles = this.vehicles.length;
                const serviceDue = this.vehicles.filter(v => this.isVehicleDue(v)).length;
                const lightVehicles = this.vehicles.filter(v => v.category === 'Light Vehicle').length;
                const heavyVehicles = this.vehicles.filter(v => v.category === 'Heavy Vehicle').length;

                this.contentArea.innerHTML = `
<div class="dashboard-header">
    <h1>Fleet Operational Overview</h1>
    <p>Strategic status of the tactical motor pool and maintenance logs.</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-truck-pickup"></i></div>
        <div class="stat-info">
            <h3>Total Fleet</h3>
            <div class="value">${totalVehicles}</div>
        </div>
    </div>
    <div class="stat-card" style="${serviceDue > 0 ? 'border-color: #e74c3c; box-shadow: 0 0 20px rgba(231,76,60,0.2);' : ''}">
        <div class="stat-icon" style="color:${serviceDue > 0 ? '#e74c3c' : 'var(--accent-color)'};">
            <i class="fas fa-tools"></i>
        </div>
        <div class="stat-info">
            <h3>Service Due</h3>
            <div class="value" style="color:${serviceDue > 0 ? '#e74c3c' : 'white'};">${serviceDue}</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-car-side"></i></div>
        <div class="stat-info">
            <h3>Light Vehicles</h3>
            <div class="value">${lightVehicles}</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-truck-moving"></i></div>
        <div class="stat-info">
            <h3>Heavy/Support</h3>
            <div class="value">${heavyVehicles}</div>
        </div>
    </div>
</div>

<div class="dashboard-content">
    <div class="panel">
        <div class="panel-header">
            <h2>Recent Maintenance Actions</h2>
            <button class="btn-link" onclick="app.setPage('vehicles')">Manage Fleet</button>
        </div>
        <div class="panel-body">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Vehicle</th>
                        <th>Type</th>
                        <th>Reg No</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    ${this.vehicles.slice(-5).reverse().map(v => `
                    <tr>
                        <td>${v.name}</td>
                        <td>${v.type}</td>
                        <td><span style="font-family:'Orbitron'; font-size:0.8rem;">${v.id}</span></td>
                        <td><span class="status-badge ${this.isVehicleDue(v) ? 'active' : 'completed'}">
                            ${this.isVehicleDue(v) ? 'Service Due' : 'Operational'}
                        </span></td>
                    </tr>
                    `).join('')}
                    ${this.vehicles.length === 0 ? `<tr><td colspan="4" style="text-align:center; color:var(--text-secondary);">No vehicles registered</td></tr>` : ''}
                </tbody>
            </table>
        </div>
    </div>

    <div class="panel">
        <div class="panel-header">
            <h2>Fleet Alerts</h2>
        </div>
        <div class="panel-body" style="padding:20px;">
            ${serviceDue > 0 ? `
                <div class="alert-item high">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="alert-content">
                        <strong>Maintenance Overdue</strong>
                        <p>${serviceDue} vehicles require immediate service attention.</p>
                    </div>
                </div>
            ` : ''}
            <div class="alert-item mid">
                <i class="fas fa-info-circle"></i>
                <div class="alert-content">
                    <strong>System Update</strong>
                    <p>Vehicle tracking database is synchronized with Firebase.</p>
                </div>
            </div>
        </div>
    </div>
</div>
`;
            },

            handleTabSwitch(e) {
                const target = e.currentTarget;
                const tab = target.getAttribute('data-tab');
                this.setPage(tab);
            },

            setPage(tab) {
                // Update active class in sidebar
                this.navItems.forEach(item => {
                    if (item.getAttribute('data-tab') === tab) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });

                // Reset sub-filters when switching main tabs
                document.querySelectorAll('.submenu li').forEach(li => li.classList.remove('active-sub'));

                this.currentTab = tab; // Track current tab

                switch (tab) {
                    case 'dashboard':
                        this.renderDashboard();
                        break;
                    case 'roster':
                        this.renderRoster();
                        break;
                    case 'person':
                        this.renderPersonnel();
                        break;
                    case 'posts':
                        this.renderDutyPosts();
                        break;
                    case 'reports':
                        this.renderReports();
                        break;
                    case 'settings':
                        this.renderSettings();
                        break;
                    case 'vehicles':
                        this.renderVehicles();
                        break;
                    default:
                        this.contentArea.innerHTML = `<div class="placeholder-view">View under construction: ${tab}</div>`;
                }
            },

            handleGlobalSearch(query) {
                if (this.currentTab === 'vehicles') {
                    this.setVehicleSearch(query);
                } else if (this.currentTab === 'person') {
                    // Personnel doesn't have a dedicated search variable yet, let's filter personnel view
                    this.personnelSearchQuery = query;
                    this.renderPersonnel();
                } else {
                    // For other tabs, maybe just log or show a toast
                    console.log("Global search is contextual. Switch to Vehicles or Personnel to search records.");
                }
            },

            renderDutyPosts() {
                this.contentArea.innerHTML = `
            <div class="dashboard-header" style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h1>Tactical Duty List</h1>
                    <p>Manage deployment locations and active assignments.</p>
                </div>
                <div style="display:flex; gap:10px; align-items:center;">
                    <select onchange="app.setRegistryFilter('currentDutyCategory', this.value)" style="background:var(--secondary-bg); border:1px solid #444; color:#fff; padding:8px 15px; border-radius:4px; font-size:0.8rem;">
                        <option value="All" ${this.currentDutyCategory === 'All' ? 'selected' : ''}>All Locations</option>
                        <option value="9 SIG BN" ${this.currentDutyCategory === '9 SIG BN' ? 'selected' : ''}>9 SIG BN</option>
                        <option value="Army Camp" ${this.currentDutyCategory === 'Army Camp' ? 'selected' : ''}>Army Camp</option>
                        <option value="RP Duty" ${this.currentDutyCategory === 'RP Duty' ? 'selected' : ''}>RP Duty</option>
                        <option value="MT Duty" ${this.currentDutyCategory === 'MT Duty' ? 'selected' : ''}>MT Duty</option>
                    </select>
                    <button class="btn-primary" onclick="app.showAddPostModal()"><i class="fas fa-plus"></i> Add New Post</button>
                </div>
            </div>
            
            <div class="posts-grid">
                ${this.posts
                        .filter(post => {
                            const postUnit = post.unit || '9 SIG BN';
                            if (this.currentDutyCategory === 'All') return true;
                            return postUnit === this.currentDutyCategory;
                        })
                        .map(post => {
                            const postAssignments = this.assignments.filter(a => a.postId === post.id);
                            const slots = post.slots || 1;
                            const used = postAssignments.length;
                            const isFull = used >= slots;

                            return `
                        <div class="post-card" data-id="${post.id}" style="${isFull ? 'border-color: #e74c3c22;' : ''}">
                            <div class="post-header">
                                <div>
                                    <div class="post-title">${post.name}</div>
                                    <div class="post-category" style="font-size:0.75rem; color:var(--accent-color);">${post.unit || '9 SIG BN'}</div>
                                    <div class="capacity-tag" style="font-size:0.75rem; margin-top:5px; color:${isFull ? '#e74c3c' : 'var(--text-secondary)'};">
                                        <i class="fas fa-users"></i> Slots: ${used} / ${slots}
                                    </div>
                                </div>
                                <i class="fas fa-trash delete-post" style="cursor:pointer; opacity:0.5;"></i>
                            </div>
                            <div class="post-assignments">
                                ${postAssignments.length > 0 ?
                                    postAssignments.map(a => `
                                        <div class="assignment-item" style="border-left: 2px solid var(--accent-color);">
                                            <div class="assignee-info">
                                                <div class="assignee-rank">${a.personnelRank}</div>
                                                <div class="assignee-name">${a.personnelName}</div>
                                                <div class="assignee-shift" style="font-size:0.7rem; color:var(--accent-color); margin-top:2px;">
                                                    <i class="fas fa-clock"></i> ${a.shift || 'N/A'}
                                                </div>
                                            </div>
                                            <i class="fas fa-times remove-assignment" data-id="${a.id}"></i>
                                        </div>
                                    `).join('') :
                                    '<div style="color:var(--text-secondary); font-size:0.8rem; font-style:italic;">No active assignments</div>'
                                }
                            </div>
                            <button class="assign-btn" ${isFull ? 'disabled style="opacity:0.5; cursor:not-allowed;"' : ''}>
                                <i class="fas fa-user-plus"></i> ${isFull ? 'Slots Full' : 'Assign Personnel'}
                            </button>
                        </div>
                    `;
                        }).join('')}
            </div>
        `;
            },

            showAddPostModal() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
            <div class="modal-content">
                <h2>Add New Deployment Post</h2>
                <div class="form-group">
                    <label>Post Name</label>
                    <input type="text" id="new-post-name" placeholder="e.g. Sector 7 Watchtower">
                </div>
                <div class="form-group">
                    <label>Duty Capacity (Slots)</label>
                    <input type="number" id="new-post-slots" value="1" min="1" max="50">
                </div>
                <div class="form-group">
                    <label>Location / Unit</label>
                    <select id="new-post-unit">
                        <option value="9 SIG BN">9 SIG BN</option>
                        <option value="Army Camp">Army Camp / Camp Duty</option>
                        <option value="RP Duty">RP Duty</option>
                        <option value="MT Duty">MT Duty</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Cancel</button>
                    <button class="btn-primary" onclick="app.addPost()">Create Post</button>
                </div>
            </div>
        `;
                document.body.appendChild(modal);
            },

            addPost() {
                const name = document.getElementById('new-post-name').value;
                const slots = parseInt(document.getElementById('new-post-slots').value) || 1;
                const unit = document.getElementById('new-post-unit').value;
                const id = 'POST-' + Math.random().toString(36).substr(2, 5).toUpperCase();

                if (name) {
                    this.posts.push({ id, name, unit, slots });
                    this.saveData();
                    this.renderDutyPosts();
                    document.querySelector('.modal-overlay').remove();
                }
            },

            deletePost(id) {
                if (confirm('Are you sure you want to decommission this post?')) {
                    this.posts = this.posts.filter(p => p.id !== id);
                    this.assignments = this.assignments.filter(a => a.postId !== id);
                    this.saveData();
                    this.renderDutyPosts();
                }
            },

            showAssignModal(postId) {
                const post = this.posts.find(p => p.id === postId);
                const postAssignments = this.assignments.filter(a => a.postId === postId);
                if (post && postAssignments.length >= (post.slots || 1)) {
                    alert("This post has reached its maximum duty capacity!");
                    return;
                }

                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
            <div class="modal-content">
                <h2>Assign Personnel</h2>
                <div class="form-group">
                    <label>Select Soldier</label>
                    <select id="assign-personnel">
                        ${this.personnel
                        .filter(p => !this.assignments.some(a => a.personnelName === p.name))
                        .map(p => `<option value="${p.name}|${p.rank}">${p.rank} ${p.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Select Shift</label>
                    <select id="assign-shift">
                        <option value="06:00 AM - 12:00 PM">06:00 AM - 12:00 PM</option>
                        <option value="12:00 PM - 06:00 PM">12:00 PM - 06:00 PM</option>
                        <option value="06:00 PM - 11:00 PM">06:00 PM - 11:00 PM</option>
                        <option value="11:00 PM - 02:00 AM">11:00 PM - 02:00 AM</option>
                        <option value="02:00 AM - 06:00 AM">02:00 AM - 06:00 AM</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Cancel</button>
                    <button class="btn-primary" onclick="app.assignPersonnel('${postId}')">Confirm Assignment</button>
                </div>
            </div>
        `;
                document.body.appendChild(modal);
            },

            assignPersonnel(postId) {
                const selection = document.getElementById('assign-personnel').value.split('|');
                const shift = document.getElementById('assign-shift').value;
                const name = selection[0];
                const rank = selection[1];

                this.assignments.push({
                    id: Date.now(),
                    postId: postId,
                    personnelName: name,
                    personnelRank: rank,
                    shift: shift
                });

                this.saveData();
                this.renderDutyPosts();
                document.querySelector('.modal-overlay').remove();
            },

            removeAssignment(id) {
                this.assignments = this.assignments.filter(a => a.id !== id);
                this.saveData();
                this.renderDutyPosts();
            },

            ranksData: {
                "Officer (Class 1 Gazetted Officer)": [
                    "Lieutenant", "Captain", "Major", "Lieutenant Colonel", "Colonel",
                    "Brigadier General", "Major General", "Lieutenant General", "General"
                ],
                "Junior Commissioned Officer (JCO)": [
                    "Warrant Officer", "Senior Warrant Officer", "Master Warrant Officer",
                    "Honorary Lieutenant", "Honorary Captain"
                ],
                "NCOs/Soldiers": [
                    "Sainik", "Lance Corporal", "Corporal", "Sergeant",
                    "Company Battery Quarter Master Sergeant", "Company Battery Sergeant Major",
                    "Battalion Regiment Quarter Master Sergeant", "Battalion Regiment Sergeant Major"
                ]
            },

            // Soldier Management
            showAddSoldierModal() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
            <div class="modal-content">
                <h2>Add New Soldier</h2>
                <div class="form-group">
                    <label>Soldier No</label>
                    <input type="text" id="sol-id" placeholder="e.g. 12345">
                </div>
                <div class="form-group">
                    <label>Rank Category</label>
                    <select id="sol-category" onchange="app.updateRankOptions()">
                        <option value="">Select Category</option>
                        ${Object.keys(this.ranksData).map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Specific Rank</label>
                    <select id="sol-rank">
                        <option value="">Select Category First</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Profession / Trade</label>
                    <select id="sol-profession">
                        ${this.professions.map(p => `<option value="${p}">${p}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="sol-name" placeholder="e.g. John Doe">
                </div>
                <div class="form-group">
                    <label>Section</label>
                    <select id="sol-section">
                        ${this.sections.map(s => `<option value="${s}">${s}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Unit</label>
                    <select id="sol-unit" onchange="app.updateUnitSubOptions()">
                        <option value="">Select Unit</option>
                        ${[...new Set(["9 SIG BN", ...Object.keys(this.unitsData)])].map(unit => `<option value="${unit}">${unit}</option>`).join('')}
                    </select>
                </div>
                <div id="camp-location-group" class="form-group" style="display:none;">
                    <label>Camp Location</label>
                    <select id="sol-camp-location">
                        <!-- Options populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Duty List</label>
                    <select id="sol-duty-list">
                        <option value="On">On</option>
                        <option value="Off">Off</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Cancel</button>
                    <button class="btn-primary" onclick="app.addSoldier()">Register Soldier</button>
                </div>
            </div>
        `;
                document.body.appendChild(modal);
            },

            updateRankOptions() {
                const category = document.getElementById('sol-category').value;
                const rankSelect = document.getElementById('sol-rank');
                rankSelect.innerHTML = '';

                if (category && this.ranksData[category]) {
                    this.ranksData[category].forEach(rank => {
                        const opt = document.createElement('option');
                        opt.value = rank;
                        opt.textContent = rank;
                        rankSelect.appendChild(opt);
                    });
                } else {
                    const opt = document.createElement('option');
                    opt.value = "";
                    opt.textContent = "Select Category First";
                    rankSelect.appendChild(opt);
                }
            },

            updateUnitSubOptions() {
                const unitName = document.getElementById('sol-unit').value;
                const campGroup = document.getElementById('camp-location-group');
                const campSelect = document.getElementById('sol-camp-location');

                const camps = this.unitsData[unitName] || [];

                if (camps.length > 0) {
                    campGroup.style.display = 'block';
                    campSelect.innerHTML = camps.map(c => `<option value="${c}">${c}</option>`).join('');
                } else {
                    campGroup.style.display = 'none';
                    campSelect.innerHTML = '';
                }
            },



            async addSoldier() {
                const name = document.getElementById('sol-name').value;
                const rank = document.getElementById('sol-rank').value;
                const id = document.getElementById('sol-id').value;
                const category = document.getElementById('sol-category').value;
                const unit = document.getElementById('sol-unit').value;
                const campLocation = document.getElementById('sol-camp-location').value;
                const section = document.getElementById('sol-section').value;
                const profession = document.getElementById('sol-profession').value;
                const dutyList = document.getElementById('sol-duty-list').value;

                if (name && rank && id) {
                    const camps = this.unitsData[unit] || [];
                    const finalUnit = camps.length > 0 ? campLocation : unit;

                    const newSoldier = {
                        id,
                        name,
                        rank,
                        category,
                        unit: finalUnit,
                        section,
                        profession,
                        dutyList
                    };

                    this.personnel.push(newSoldier);
                    await this.saveData();
                    this.renderPersonnel();
                    document.querySelector('.modal-overlay').remove();


                } else {
                    alert('Please fill all tactical data fields.');
                }
            },

            async deleteSoldier(id) {
                if (confirm('Are you sure you want to remove this personnel from registry?')) {
                    const soldier = this.personnel.find(p => p.id === id);
                    this.personnel = this.personnel.filter(p => p.id !== id);
                    if (soldier) {
                        this.assignments = this.assignments.filter(a => a.personnelName !== soldier.name);
                    }

                    await this.saveData();
                    this.renderPersonnel();


                }
            },

            showEditSoldierModal(id) {
                const soldier = this.personnel.find(p => p.id === id);
                if (!soldier) return;

                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
            <div class="modal-content">
                <h2>Edit Soldier Details</h2>
                <div class="form-group">
                    <label>Soldier No (Read Only)</label>
                    <input type="text" id="edit-sol-id" value="${soldier.id}" readonly style="opacity:0.6; cursor:not-allowed;">
                </div>
                <div class="form-group">
                    <label>Rank Category</label>
                    <select id="edit-sol-category" onchange="app.updateEditRankOptions()">
                        <option value="">Select Category</option>
                        ${Object.keys(this.ranksData).map(cat => `<option value="${cat}" ${soldier.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Specific Rank</label>
                    <select id="edit-sol-rank">
                         <!-- Populated by updateEditRankOptions -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Profession / Trade</label>
                    <select id="edit-sol-profession">
                        ${this.professions.map(p => `<option value="${p}" ${soldier.profession === p ? 'selected' : ''}>${p}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="edit-sol-name" value="${soldier.name}">
                </div>
                <div class="form-group">
                    <label>Section</label>
                    <select id="edit-sol-section">
                        ${this.sections.map(s => `<option value="${s}" ${soldier.section === s ? 'selected' : ''}>${s}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Unit</label>
                    <select id="edit-sol-unit" onchange="app.updateEditUnitSubOptions()">
                        <option value="">Select Unit</option>
                        ${[...new Set(["9 SIG BN", ...Object.keys(this.unitsData)])].map(unit => {
                    const isSelected = unit === soldier.unit || (this.unitsData[unit] && this.unitsData[unit].includes(soldier.unit));
                    return `<option value="${unit}" ${isSelected ? 'selected' : ''}>${unit}</option>`;
                }).join('')}
                    </select>
                </div>
                <div id="edit-camp-location-group" class="form-group" style="display:none;">
                    <label>Camp Location</label>
                    <select id="edit-sol-camp-location">
                        <!-- Options populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Duty List</label>
                    <select id="edit-sol-duty-list">
                        <option value="On" ${soldier.dutyList === 'On' ? 'selected' : ''}>On</option>
                        <option value="Off" ${soldier.dutyList === 'Off' ? 'selected' : ''}>Off</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Cancel</button>
                    <button class="btn-primary" onclick="app.updateSoldier('${id}')">Update Soldier</button>
                </div>
            </div>
        `;
                document.body.appendChild(modal);

                // Initial population of dependent dropdowns
                this.updateEditRankOptions(soldier.rank);
                this.updateEditUnitSubOptions(soldier.unit);
            },

            updateEditRankOptions(selectedRank = null) {
                const category = document.getElementById('edit-sol-category').value;
                const rankSelect = document.getElementById('edit-sol-rank');
                rankSelect.innerHTML = '';

                if (category && this.ranksData[category]) {
                    this.ranksData[category].forEach(rank => {
                        const opt = document.createElement('option');
                        opt.value = rank;
                        opt.textContent = rank;
                        if (selectedRank === rank) opt.selected = true;
                        rankSelect.appendChild(opt);
                    });
                }
            },

            // Vehicle Management System (Garir Hisab)
            renderVehicles() {
                // Filter vehicles based on search, category, type, company, and status
                const filteredVehicles = this.vehicles.filter(v => {
                    const matchSearch = !this.vehicleSearchQuery ||
                        v.name.toLowerCase().includes(this.vehicleSearchQuery.toLowerCase());
                    const matchCategory = this.currentVehicleCategoryFilter === 'All' || v.category === this.currentVehicleCategoryFilter;
                    const matchType = this.currentVehicleTypeFilter === 'All' || v.type === this.currentVehicleTypeFilter;
                    const matchCompany = this.currentVehicleCompanyFilter === 'All' || v.company === this.currentVehicleCompanyFilter;
                    const matchStatus = this.vehicleStatusFilter === 'All' || (this.vehicleStatusFilter === 'Due' && this.isVehicleDue(v));
                    return matchSearch && matchCategory && matchType && matchCompany && matchStatus;
                });

                const activeSearchId = document.activeElement?.id === 'v-search-input' ? 'v-search-input' : null;
                const selectionStart = activeSearchId ? document.activeElement.selectionStart : null;

                this.contentArea.innerHTML = `
            <div class="dashboard-header" style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:20px;">
                <div>
                    <h1>Vehicle Management</h1>
                    <p>Track maintenance schedules, oil changes, and fitness dates.</p>
                </div>
                <div style="display:flex; gap:15px; align-items:center; flex-wrap:wrap;">
                    <div class="view-toggles" style="display:flex; gap:5px; background:rgba(255,255,255,0.05); padding:4px; border-radius:8px; border: 1px solid var(--border-color);">
                        <button class="view-mode-btn ${this.vehicleViewMode === 'list' ? 'active' : ''}" 
                            onclick="app.setVehicleViewMode('list')" title="List View"><i class="fas fa-list"></i></button>
                        <button class="view-mode-btn ${this.vehicleViewMode === 'grid' ? 'active' : ''}" 
                            onclick="app.setVehicleViewMode('grid')" title="Grid View"><i class="fas fa-th-large"></i></button>
                    </div>
                    <button class="btn-primary" onclick="app.showAddVehicleModal()"><i class="fas fa-plus"></i> Add Vehicle</button>
                </div>
            </div>

            ${this.selectedVehicleId ? this.renderServiceMonitorBar() : ''}

            <div class="filter-bar" style="display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; background:rgba(255,255,255,0.02); padding:15px; border-radius:8px; border:1px solid rgba(255,255,255,0.05);">
                <div class="filter-item">
                    <label style="display:block; font-size:0.7rem; color:var(--text-secondary); margin-bottom:5px; text-transform:uppercase;">Search Reg No</label>
                    <div class="search-box" style="position:relative;">
                        <i class="fas fa-search" style="position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text-secondary); font-size:0.8rem;"></i>
                        <input type="text" id="v-search-input" placeholder="e.g. Jeep-123" value="${this.vehicleSearchQuery}" 
                            oninput="app.setVehicleSearch(this.value)"
                            style="padding: 8px 12px 8px 35px; background:var(--secondary-bg); border:1px solid #444; border-radius:4px; color:#fff; font-size:0.8rem; width:180px;">
                    </div>
                </div>
                <div class="filter-item">
                    <label style="display:block; font-size:0.7rem; color:var(--text-secondary); margin-bottom:5px; text-transform:uppercase;">Company/Unit</label>
                    <select onchange="app.setRegistryFilter('currentVehicleCompanyFilter', this.value); app.vehicleStatusFilter = 'All';" 
                        style="background:var(--secondary-bg); border:1px solid #444; color:#fff; padding:8px 12px; border-radius:4px; font-size:0.75rem; width:150px;">
                        <option value="All" ${this.currentVehicleCompanyFilter === 'All' ? 'selected' : ''}>All Companies</option>
                        ${this.sections.map(c => `<option value="${c}" ${this.currentVehicleCompanyFilter === c ? 'selected' : ''}>${c}</option>`).join('')}
                    </select>
                </div>
                <div class="filter-item">
                    <label style="display:block; font-size:0.7rem; color:var(--text-secondary); margin-bottom:5px; text-transform:uppercase;">Category</label>
                    <select onchange="app.setRegistryFilter('currentVehicleCategoryFilter', this.value); app.vehicleStatusFilter = 'All';" 
                        style="background:var(--secondary-bg); border:1px solid #444; color:#fff; padding:8px 12px; border-radius:4px; font-size:0.75rem; width:150px;">
                        <option value="All" ${this.currentVehicleCategoryFilter === 'All' ? 'selected' : ''}>All Categories</option>
                        ${Object.keys(this.vehicleCategories).map(cat => `<option value="${cat}" ${this.currentVehicleCategoryFilter === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                    </select>
                </div>
            </div>

            <div class="stats-grid" style="margin-bottom: 25px; display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                <div class="stat-card ${this.currentVehicleTypeFilter === 'All' && this.currentVehicleCategoryFilter === 'All' && this.vehicleStatusFilter === 'All' ? 'active-filter' : ''}" onclick="app.setVehicleTypeFilter('All'); app.setRegistryFilter('currentVehicleCategoryFilter', 'All'); app.setVehicleStatusFilter('All');" style="cursor:pointer;">
                    <div class="stat-icon"><i class="fas fa-truck"></i></div>
                    <div class="stat-info">
                        <h3>Total</h3>
                        <div class="value">${this.vehicles.length}</div>
                    </div>
                </div>
                <div class="stat-card ${this.vehicleStatusFilter === 'Due' ? 'active-filter' : ''}" onclick="app.setVehicleStatusFilter('Due')" style="cursor:pointer; border-color: ${this.vehicles.filter(v => this.isVehicleDue(v)).length > 0 ? '#e74c3c' : 'rgba(231,76,60,0.2)'}">
                    <div class="stat-icon" style="color:#e74c3c; background:rgba(231,76,60,0.1);"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="stat-info">
                        <h3>Service Due</h3>
                        <div class="value" style="color:#e74c3c;">${this.vehicles.filter(v => this.isVehicleDue(v)).length}</div>
                    </div>
                </div>
                <div class="stat-card ${this.currentVehicleTypeFilter === 'Jeep' && this.vehicleStatusFilter === 'All' ? 'active-filter' : ''}" onclick="app.setVehicleTypeFilter('Jeep'); app.setRegistryFilter('currentVehicleCategoryFilter', 'All'); app.setVehicleStatusFilter('All');" style="cursor:pointer;">
                    <div class="stat-icon" style="color:#1abc9c; background:rgba(26,188,156,0.1);"><i class="fas fa-car-side"></i></div>
                    <div class="stat-info">
                        <h3>Jeep</h3>
                        <div class="value">${this.vehicles.filter(v => v.type === 'Jeep').length}</div>
                    </div>
                </div>
                <div class="stat-card ${this.currentVehicleTypeFilter === 'Pickup' && this.vehicleStatusFilter === 'All' ? 'active-filter' : ''}" onclick="app.setVehicleTypeFilter('Pickup'); app.setRegistryFilter('currentVehicleCategoryFilter', 'All'); app.setVehicleStatusFilter('All');" style="cursor:pointer;">
                    <div class="stat-icon" style="color:#e67e22; background:rgba(230,126,34,0.1);"><i class="fas fa-truck-pickup"></i></div>
                    <div class="stat-info">
                        <h3>Pickup</h3>
                        <div class="value">${this.vehicles.filter(v => v.type === 'Pickup').length}</div>
                    </div>
                </div>
                <div class="stat-card ${this.currentVehicleTypeFilter === '3-Ton' && this.vehicleStatusFilter === 'All' ? 'active-filter' : ''}" onclick="app.setVehicleTypeFilter('3-Ton'); app.setRegistryFilter('currentVehicleCategoryFilter', 'All'); app.setVehicleStatusFilter('All');" style="cursor:pointer;">
                    <div class="stat-icon" style="color:#3498db; background:rgba(52,152,219,0.1);"><i class="fas fa-truck-moving"></i></div>
                    <div class="stat-info">
                        <h3>3-Ton</h3>
                        <div class="value">${this.vehicles.filter(v => v.type === '3-Ton').length}</div>
                    </div>
                </div>
                <div class="stat-card ${this.currentVehicleTypeFilter === 'Motorcycle' && this.vehicleStatusFilter === 'All' ? 'active-filter' : ''}" onclick="app.setVehicleTypeFilter('Motorcycle'); app.setRegistryFilter('currentVehicleCategoryFilter', 'All'); app.setVehicleStatusFilter('All');" style="cursor:pointer;">
                    <div class="stat-icon" style="color:#9b59b6; background:rgba(155,89,182,0.1);"><i class="fas fa-motorcycle"></i></div>
                    <div class="stat-info">
                        <h3>Motorcycle</h3>
                        <div class="value">${this.vehicles.filter(v => v.type === 'Motorcycle').length}</div>
                    </div>
                </div>
            </div>
            ${this.vehicleViewMode === 'grid' ? `
            <div class="vehicle-grid">
                ${filteredVehicles.length > 0 ? filteredVehicles.map(v => this.createVehicleCard(v)).join('') :
                            '<div style="grid-column:1/-1; text-align:center; padding:50px; color:var(--text-secondary);">No vehicles found matching the filters.</div>'}
            </div>
            ` : `
            <div class="panel">
                <div class="panel-body" style="overflow-x:auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Reg No</th>
                                <th>Category</th>
                                <th>Type</th>
                                <th>Company</th>
                                <th>Current KM</th>
                                <th>Engine Oil</th>
                                <th>Oil Filter</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredVehicles.length > 0 ? filteredVehicles.map(v => `
                                <tr class="${this.selectedVehicleId === v.id ? 'active-row' : ''}" onclick="app.selectVehicle('${v.id}')" style="cursor:pointer;">
                                    <td style="font-family: 'Orbitron', sans-serif; font-size:0.8rem;">${v.name}</td>
                                    <td><span style="color:var(--text-secondary); font-size: 0.8rem;">${v.category || 'N/A'}</span></td>
                                    <td>${v.type}</td>
                                    <td style="font-size: 0.85rem; color: var(--accent-color);">${v.company || 'N/A'}</td>
                                    <td style="font-family: monospace;">${v.currentKm}</td>
                                    <td>${this.renderMiniDateStatus(v.dates?.engineOil)}</td>
                                    <td>${this.renderMiniDateStatus(v.dates?.oilFilter)}</td>
                                    <td>
                                        ${this.isVehicleDue(v) ? '<span class="status-badge active">Service Due</span>' : ''}
                                    </td>
                                    <td>
                                        <i class="fas fa-wrench" onclick="event.stopPropagation(); app.showEditVehicleModal('${v.id}')" style="color:var(--accent-color); cursor:pointer; margin-right:12px;" title="Update Status"></i>
                                        <i class="fas fa-trash-alt" onclick="event.stopPropagation(); app.deleteVehicle('${v.id}')" style="color:#e74c3c; cursor:pointer;" title="Delete Vehicle"></i>
                                    </td>
                                </tr>
                            `).join('') : `<tr><td colspan="9" style="text-align:center; padding:30px; color:var(--text-secondary);">No vehicles found matching the filters.</td></tr>`}
                        </tbody>
                    </table>
                </div>
            </div>
            `}
            `;

                if (activeSearchId) {
                    setTimeout(() => {
                        const input = document.getElementById(activeSearchId);
                        if (input) {
                            input.focus();
                            input.setSelectionRange(selectionStart, selectionStart);
                        }
                    }, 0);
                }
            },

            setVehicleTypeFilter(type) {
                this.currentVehicleTypeFilter = type;
                this.renderVehicles();
            },

            setVehicleViewMode(mode) {
                this.vehicleViewMode = mode;
                this.renderVehicles();
            },

            setVehicleSearch(query) {
                this.vehicleSearchQuery = query;
                this.renderVehicles();
            },

            setVehicleStatusFilter(status) {
                this.vehicleStatusFilter = status;
                if (status === 'Due') {
                    this.currentVehicleTypeFilter = 'All';
                    this.currentVehicleCategoryFilter = 'All';
                }
                this.renderVehicles();
            },

            isVehicleDue(v) {
                return this.checkKmAlerts(v).length > 0 || this.checkDateAlerts(v).length > 0;
            },

            selectVehicle(id) {
                this.selectedVehicleId = (this.selectedVehicleId === id) ? null : id;
                this.renderVehicles();
            },

            renderServiceMonitorBar() {
                const v = this.vehicles.find(v => v.id === this.selectedVehicleId);
                if (!v) return '';

                const kmAlerts = this.checkKmAlerts(v);
                const dateAlerts = this.checkDateAlerts(v);
                const allAlerts = [...kmAlerts, ...dateAlerts];

                return `
                    <div class="service-monitor-bar" style="margin-bottom:20px; padding:15px; background:rgba(255,255,255,0.03); border-radius:12px; border:1px solid rgba(255,255,255,0.1); display:flex; align-items:center; justify-content:space-between; animation: slideIn 0.3s ease-out;">
                        <div style="display:flex; align-items:center; gap:20px;">
                            <div style="background:var(--accent-color); color:#fff; width:45px; height:45px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.2rem;">
                                <i class="fas fa-microchip"></i>
                            </div>
                            <div>
                                <div style="font-size:0.75rem; color:var(--text-secondary); text-transform:uppercase; letter-spacing:1px;">Active Analysis</div>
                                <h2 style="margin:0; font-size:1.2rem; display:flex; align-items:center; gap:10px;">
                                    ${v.name} 
                                    <span style="font-size:0.7rem; background:rgba(255,255,255,0.05); padding:2px 8px; border-radius:4px; font-weight:normal; color:var(--text-secondary);">${v.id}</span>
                                </h2>
                            </div>
                        </div>
                        
                        <div style="flex:1; margin:0 40px; border-left:1px solid rgba(255,255,255,0.1); padding-left:40px;">
                            ${allAlerts.length > 0 ? `
                                <div style="font-size:0.75rem; color:#e74c3c; font-weight:bold; margin-bottom:5px; text-transform:uppercase;">
                                    <i class="fas fa-exclamation-triangle"></i> Maintenance Required
                                </div>
                                <div style="display:flex; flex-wrap:wrap; gap:8px;">
                                    ${allAlerts.map(a => `
                                        <span style="font-size:0.7rem; background:rgba(231,76,60,0.15); color:#e74c3c; border:1px solid rgba(231,76,60,0.3); padding:4px 10px; border-radius:6px; font-weight:500;">
                                            ${a.name}
                                        </span>
                                    `).join('')}
                                </div>
                            ` : `
                                <div style="color:var(--text-secondary); font-size:0.8rem; opacity:0.6;">No service required at this time.</div>
                            `}
                        </div>

                        <div style="display:flex; gap:10px;">
                            <button class="btn-primary" onclick="app.showEditVehicleModal('${v.id}')" style="padding:8px 15px;">
                                <i class="fas fa-tools"></i> Service Now
                            </button>
                            <button class="btn-secondary" onclick="app.selectVehicle(null)" style="padding:8px; width:36px; height:36px; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
            },

            setRegistryFilter(key, value) {
                this[key] = value;
                if (key === 'currentDutyCategory') {
                    this.renderDutyPosts();
                } else if (key.toLowerCase().includes('vehicle')) {
                    this.renderVehicles();
                } else {
                    this.renderPersonnel();
                }
            },

            renderMiniDateStatus(dateStr) {
                if (!dateStr) return '<span style="color:#666;">N/A</span>';
                const today = new Date();
                const targetDate = new Date(dateStr);
                const diffTime = targetDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                const isRed = diffDays <= 15;
                const isWarning = diffDays <= 30 && diffDays > 15;
                const color = isRed ? '#e74c3c' : (isWarning ? '#f1c40f' : '#2ecc71');
                return `<span style="color:${color}; font-size:0.8rem;">${diffDays < 0 ? 'Exp' : `${diffDays}d`}</span>`;
            },

            createVehicleCard(v) {
                // Calculate Alerts - all items are now date-based
                const dateAlerts = this.checkDateAlerts(v);
                const hasRedAlert = dateAlerts.some(a => a.isRed);

                return `
                    <div class="vehicle-card ${this.selectedVehicleId === v.id ? 'selected-card' : ''} ${hasRedAlert ? 'alert-pulse' : ''}" 
                        onclick="app.selectVehicle('${v.id}')" 
                        style="cursor:pointer; ${hasRedAlert ? 'border-color:#e74c3c;' : ''}${this.selectedVehicleId === v.id ? 'border:2px solid var(--accent-color);' : ''}">
                <div class="vehicle-header">
                    <div style="display:flex; gap:15px; align-items:center;">
                        <div class="vehicle-icon">
                            <i class="fas fa-truck-pickup"></i>
                        </div>
                        <div class="vehicle-info">
                            <div style="font-size:0.7rem; color:var(--text-secondary); text-transform:uppercase; letter-spacing:1px; margin-bottom:2px;">${v.category || 'Uncategorized'}</div>
                            <h3>${v.name}</h3>
                            <div class="vehicle-type">${v.type}</div>
                            <div style="font-size:0.75rem; color:var(--accent-color); margin-top:2px;">${v.company || 'No Company'}</div>
                        </div>
                    </div>
                    <div class="km-badge">Current: ${v.currentKm} KM</div>
                </div>

                <div class="maintenance-list">
                    ${this.renderDateItem('Engine Oil', v.dates.engineOil)}
                    ${this.renderDateItem('Transmission Oil', v.dates.transmissionOil)}
                    ${this.renderDateItem('Oil Filter', v.dates.oilFilter)}
                    ${this.renderDateItem('Fuel Filter', v.dates.fuelFilter)}
                    ${this.renderDateItem('Air Filter', v.dates.airFilter)}
                    ${this.renderDateItem('Battery Change', v.dates.battery)}
                    ${this.renderDateItem('Anti-Corrosion', v.dates.antiCorrosion)}
                </div>

                <div class="vehicle-actions">
                    <button class="btn-primary" style="flex:1; justify-content:center;" onclick="app.showEditVehicleModal('${v.id}')">
                        <i class="fas fa-wrench"></i> Update Status
                    </button>
                     <button class="btn-icon" onclick="app.deleteVehicle('${v.id}')" title="Delete Vehicle">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                </div>
            `;
            },

            renderMaintenanceItem(label, current, limit, type) {
                if (!limit) return '';
                const remaining = limit - current;
                const isRed = remaining <= 200;
                const isWarning = remaining <= 500 && remaining > 200;
                const statusClass = isRed ? 'alert' : (isWarning ? 'warning' : '');

                return `
            <div class="maintenance-item ${statusClass}">
                    <div class="maintenance-label">
                        <i class="fas fa-oil-can" style="font-size:0.8rem; opacity:0.7;"></i>
                        ${label}
                    </div>
                    <div class="maintenance-status">
                        ${isRed ? '<i class="fas fa-exclamation-circle"></i>' : ''} 
                        ${remaining} KM Left
                    </div>
                </div>`;
            },

            renderDateItem(label, dateStr) {
                if (!dateStr) return '';
                const today = new Date();
                const targetDate = new Date(dateStr);
                const diffTime = targetDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                const isRed = diffDays <= 15;
                const isWarning = diffDays <= 30 && diffDays > 15;
                const statusClass = isRed ? 'alert' : (isWarning ? 'warning' : '');

                return `
            <div class="maintenance-item ${statusClass}">
                    <div class="maintenance-label">
                        <i class="fas fa-calendar-check" style="font-size:0.8rem; opacity:0.7;"></i>
                        ${label}
                    </div>
                    <div class="maintenance-status">
                         ${isRed ? '<i class="fas fa-exclamation-circle"></i>' : ''} 
                        ${diffDays < 0 ? 'Expired' : `${diffDays} Days Left`}
                    </div>
                </div>`;
            },

            checkKmAlerts(v) {
                const alerts = [];
                if (!v.limits) return alerts;
                const check = (limit, name) => {
                    if (limit) {
                        const remaining = limit - v.currentKm;
                        if (remaining <= 200) alerts.push({ name, isRed: true });
                    }
                };
                check(v.limits.engineOil, 'Engine Oil');
                check(v.limits.transmissionOil, 'Transmission Oil');
                check(v.limits.oilFilter, 'Oil Filter');
                check(v.limits.fuelFilter, 'Fuel Filter');
                check(v.limits.airFilter, 'Air Filter');
                return alerts;
            },

            checkDateAlerts(v) {
                const alerts = [];
                const check = (dateStr, name) => {
                    if (dateStr) {
                        const today = new Date();
                        const targetDate = new Date(dateStr);
                        const diffTime = targetDate - today;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        if (diffDays <= 15) alerts.push({ name, isRed: true });
                    }
                };
                // Check all maintenance dates
                if (v.dates) {
                    check(v.dates.engineOil, 'Engine Oil');
                    check(v.dates.transmissionOil, 'Transmission Oil');
                    check(v.dates.oilFilter, 'Oil Filter');
                    check(v.dates.fuelFilter, 'Fuel Filter');
                    check(v.dates.airFilter, 'Air Filter');
                    check(v.dates.battery, 'Battery');
                    check(v.dates.antiCorrosion, 'Anti-Corrosion');
                }
                return alerts;
            },

            showAddVehicleModal() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
            <div class="modal-content" style="width: 550px; max-height: 90vh; overflow-y: auto; padding: 25px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                    <h2 style="margin:0; font-size: 1.4rem;">Add New Vehicle</h2>
                    <i class="fas fa-times" onclick="this.closest('.modal-overlay').remove()" style="cursor:pointer; color:var(--text-secondary);"></i>
                </div>
                
                <div class="form-section" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:8px; margin-bottom:20px;">
                    <h3 style="font-size:0.9rem; color:var(--accent-color); margin-bottom:15px; text-transform:uppercase; letter-spacing:1px;">General Information</h3>
                    <div class="form-group" style="margin-bottom:15px;">
                        <label>Vehicle Name / Reg No</label>
                        <input type="text" id="v-name" placeholder="e.g. Jeep-1234">
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div class="form-group" style="margin-bottom:15px;">
                            <label>Category</label>
                            <select id="v-category" onchange="app.updateVehicleTypeOptions()">
                                <option value="">Select Category</option>
                                ${Object.keys(this.vehicleCategories).map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:15px;">
                            <label>Type</label>
                            <select id="v-type">
                                <option value="">Select Category First</option>
                            </select>
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Company/Unit</label>
                            <select id="v-company">
                                <option value="">Select Company</option>
                                ${this.sections.map(c => `<option value="${c}">${c}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Current KM</label>
                            <input type="number" id="v-km" placeholder="e.g. 50000">
                        </div>
                    </div>
                </div>
                
                <div class="form-section" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:8px; margin-bottom:20px;">
                    <h3 style="font-size:0.9rem; color:var(--accent-color); margin-bottom:15px; text-transform:uppercase; letter-spacing:1px;">Maintenance Schedule</h3>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Engine Oil Change</label>
                            <select id="v-dur-eng" onchange="app.setMaintenanceDate('v-dur-eng', 'v-date-eng')" style="padding:8px; margin-bottom:5px; font-size:0.85rem;">
                                <option value="">Set Duration...</option>
                                <option value="3">3 Months</option>
                                <option value="6">6 Months</option>
                                <option value="12">1 Year</option>
                            </select>
                            <input type="date" id="v-date-eng" style="padding:8px; font-size:0.85rem;">
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Transmission Oil</label>
                            <select id="v-dur-trans" onchange="app.setMaintenanceDate('v-dur-trans', 'v-date-trans')" style="padding:8px; margin-bottom:5px; font-size:0.85rem;">
                                <option value="">Set Duration...</option>
                                <option value="6">6 Months</option>
                                <option value="12">1 Year</option>
                                <option value="24">2 Years</option>
                            </select>
                            <input type="date" id="v-date-trans" style="padding:8px; font-size:0.85rem;">
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Oil Filter</label>
                            <select id="v-dur-oilfilt" onchange="app.setMaintenanceDate('v-dur-oilfilt', 'v-date-oilfilt')" style="padding:8px; margin-bottom:5px; font-size:0.85rem;">
                                <option value="">Set Duration...</option>
                                <option value="3">3 Months</option>
                                <option value="6">6 Months</option>
                                <option value="12">1 Year</option>
                            </select>
                            <input type="date" id="v-date-oilfilt" style="padding:8px; font-size:0.85rem;">
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Fuel Filter</label>
                            <select id="v-dur-fuelfilt" onchange="app.setMaintenanceDate('v-dur-fuelfilt', 'v-date-fuelfilt')" style="padding:8px; margin-bottom:5px; font-size:0.85rem;">
                                <option value="">Set Duration...</option>
                                <option value="6">6 Months</option>
                                <option value="12">1 Year</option>
                                <option value="24">2 Years</option>
                            </select>
                            <input type="date" id="v-date-fuelfilt" style="padding:8px; font-size:0.85rem;">
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Air Filter</label>
                            <select id="v-dur-airfilt" onchange="app.setMaintenanceDate('v-dur-airfilt', 'v-date-airfilt')" style="padding:8px; margin-bottom:5px; font-size:0.85rem;">
                                <option value="">Set Duration...</option>
                                <option value="6">6 Months</option>
                                <option value="12">1 Year</option>
                                <option value="24">2 Years</option>
                            </select>
                            <input type="date" id="v-date-airfilt" style="padding:8px; font-size:0.85rem;">
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Battery/Other</label>
                            <select id="v-dur-bat" onchange="app.setMaintenanceDate('v-dur-bat', 'v-date-bat')" style="padding:8px; margin-bottom:5px; font-size:0.85rem;">
                                <option value="">Set Duration...</option>
                                <option value="12">1 Year</option>
                                <option value="24">2 Years</option>
                            </select>
                            <input type="date" id="v-date-bat" style="padding:8px; font-size:0.85rem;">
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Anti-Corrosion</label>
                            <select id="v-dur-anti" onchange="app.setMaintenanceDate('v-dur-anti', 'v-date-anti')" style="padding:8px; margin-bottom:5px; font-size:0.85rem;">
                                <option value="">Set Duration...</option>
                                <option value="12">1 Year</option>
                            </select>
                            <input type="date" id="v-date-anti" style="padding:8px; font-size:0.85rem;">
                        </div>
                    </div>
                </div>

                <div class="form-actions" style="margin-top:0;">
                    <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Cancel</button>
                    <button class="btn-primary" onclick="app.addVehicle()">Add Vehicle</button>
                </div>
            </div>
        `;
                document.body.appendChild(modal);
            },

            addVehicle() {
                const name = document.getElementById('v-name').value;
                const category = document.getElementById('v-category').value;
                const type = document.getElementById('v-type').value;
                const company = document.getElementById('v-company').value;
                const currentKm = parseInt(document.getElementById('v-km').value) || 0;

                if (!name || !category || !type) { alert('Please fill all required fields'); return; }

                const newVehicle = {
                    id: 'VEH-' + Math.random().toString(36).substr(2, 6).toUpperCase(),
                    name,
                    category,
                    type,
                    company,
                    currentKm,
                    dates: {
                        engineOil: document.getElementById('v-date-eng').value,
                        transmissionOil: document.getElementById('v-date-trans').value,
                        oilFilter: document.getElementById('v-date-oilfilt').value,
                        fuelFilter: document.getElementById('v-date-fuelfilt').value,
                        airFilter: document.getElementById('v-date-airfilt').value,
                        battery: document.getElementById('v-date-bat').value,
                        antiCorrosion: document.getElementById('v-date-anti').value
                    }
                };

                this.vehicles.push(newVehicle);
                this.saveData();
                this.renderVehicles();
                document.querySelector('.modal-overlay').remove();
            },

            showEditVehicleModal(id) {
                const v = this.vehicles.find(v => v.id === id);
                if (!v) return;

                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
            <div class="modal-content" style="width: 550px; max-height: 90vh; overflow-y: auto; padding: 25px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                    <h2 style="margin:0; font-size: 1.4rem;">Update Vehicle: ${v.name}</h2>
                    <i class="fas fa-times" onclick="this.closest('.modal-overlay').remove()" style="cursor:pointer; color:var(--text-secondary);"></i>
                </div>
                
                <div class="form-section" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:8px; margin-bottom:20px;">
                    <h3 style="font-size:0.9rem; color:var(--accent-color); margin-bottom:15px; text-transform:uppercase; letter-spacing:1px;">General Information</h3>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div class="form-group" style="margin-bottom:15px;">
                            <label>Category</label>
                            <select id="edit-v-category" onchange="app.updateEditVehicleTypeOptions()">
                                <option value="">Select Category</option>
                                ${Object.keys(this.vehicleCategories).map(cat => `<option value="${cat}" ${v.category === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:15px;">
                            <label>Type</label>
                            <select id="edit-v-type">
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Company/Unit</label>
                            <select id="edit-v-company">
                                <option value="">Select Company</option>
                                ${this.sections.map(c => `<option value="${c}" ${v.company === c ? 'selected' : ''}>${c}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label>Current KM</label>
                            <input type="number" id="edit-v-km" value="${v.currentKm}">
                        </div>
                    </div>
                </div>
                
                <div class="form-section" style="background:rgba(255,255,255,0.03); padding:15px; border-radius:8px; margin-bottom:20px;">
                    <h3 style="font-size:0.9rem; color:var(--accent-color); margin-bottom:15px; text-transform:uppercase; letter-spacing:1px;">Maintenance History</h3>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Engine Oil</label>
                            <input type="date" id="edit-v-date-eng" value="${v.dates?.engineOil || ''}" style="padding:8px; font-size:0.85rem; margin-bottom:5px;">
                            <select id="edit-v-dur-eng" onchange="app.setMaintenanceDate('edit-v-dur-eng', 'edit-v-date-eng')" style="padding:8px; font-size:0.8rem;">
                                <option value="">Reset Duration...</option>
                                <option value="3">+3 Months</option>
                                <option value="6">+6 Months</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Transmission Oil</label>
                            <input type="date" id="edit-v-date-trans" value="${v.dates?.transmissionOil || ''}" style="padding:8px; font-size:0.85rem; margin-bottom:5px;">
                            <select id="edit-v-dur-trans" onchange="app.setMaintenanceDate('edit-v-dur-trans', 'edit-v-date-trans')" style="padding:8px; font-size:0.8rem;">
                                <option value="">Reset Duration...</option>
                                <option value="12">+1 Year</option>
                                <option value="24">+2 Years</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Oil Filter</label>
                            <input type="date" id="edit-v-date-oilfilt" value="${v.dates?.oilFilter || ''}" style="padding:8px; font-size:0.85rem; margin-bottom:5px;">
                            <select id="edit-v-dur-oilfilt" onchange="app.setMaintenanceDate('edit-v-dur-oilfilt', 'edit-v-date-oilfilt')" style="padding:8px; font-size:0.8rem;">
                                <option value="">Reset Duration...</option>
                                <option value="3">+3 Months</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Fuel Filter</label>
                            <input type="date" id="edit-v-date-fuelfilt" value="${v.dates?.fuelFilter || ''}" style="padding:8px; font-size:0.85rem; margin-bottom:5px;">
                            <select id="edit-v-dur-fuelfilt" onchange="app.setMaintenanceDate('edit-v-dur-fuelfilt', 'edit-v-date-fuelfilt')" style="padding:8px; font-size:0.8rem;">
                                <option value="">Reset Duration...</option>
                                <option value="12">+1 Year</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Air Filter</label>
                            <input type="date" id="edit-v-date-airfilt" value="${v.dates?.airFilter || ''}" style="padding:8px; font-size:0.85rem; margin-bottom:5px;">
                            <select id="edit-v-dur-airfilt" onchange="app.setMaintenanceDate('edit-v-dur-airfilt', 'edit-v-date-airfilt')" style="padding:8px; font-size:0.8rem;">
                                <option value="">Reset Duration...</option>
                                <option value="12">+1 Year</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Battery</label>
                            <input type="date" id="edit-v-date-bat" value="${v.dates?.battery || ''}" style="padding:8px; font-size:0.85rem; margin-bottom:5px;">
                            <select id="edit-v-dur-bat" onchange="app.setMaintenanceDate('edit-v-dur-bat', 'edit-v-date-bat')" style="padding:8px; font-size:0.8rem;">
                                <option value="">Reset Duration...</option>
                                <option value="24">+2 Years</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label style="font-size:0.8rem;">Anti-Corrosion</label>
                            <input type="date" id="edit-v-date-anti" value="${v.dates?.antiCorrosion || ''}" style="padding:8px; font-size:0.85rem; margin-bottom:5px;">
                            <select id="edit-v-dur-anti" onchange="app.setMaintenanceDate('edit-v-dur-anti', 'edit-v-date-anti')" style="padding:8px; font-size:0.8rem;">
                                <option value="">Reset Duration...</option>
                                <option value="12">+1 Year</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-actions" style="margin-top:0;">
                    <button class="btn-secondary" onclick="this.closest('.modal-overlay').remove()">Cancel</button>
                    <button class="btn-primary" onclick="app.updateVehicle('${id}')">Save Changes</button>
                </div>
            </div>
            `;
                document.body.appendChild(modal);

                // Initial population of dependent dropdowns
                this.updateEditVehicleTypeOptions(v.type);
            },

            updateVehicle(id) {
                const v = this.vehicles.find(v => v.id === id);
                if (v) {
                    v.currentKm = parseInt(document.getElementById('edit-v-km').value) || 0;
                    v.category = document.getElementById('edit-v-category').value;
                    v.type = document.getElementById('edit-v-type').value;
                    v.company = document.getElementById('edit-v-company').value;

                    // Ensure dates object exists
                    if (!v.dates) v.dates = {};

                    v.dates.engineOil = document.getElementById('edit-v-date-eng').value;
                    v.dates.transmissionOil = document.getElementById('edit-v-date-trans').value;
                    v.dates.oilFilter = document.getElementById('edit-v-date-oilfilt').value;
                    v.dates.fuelFilter = document.getElementById('edit-v-date-fuelfilt').value;
                    v.dates.airFilter = document.getElementById('edit-v-date-airfilt').value;
                    v.dates.battery = document.getElementById('edit-v-date-bat').value;
                    v.dates.antiCorrosion = document.getElementById('edit-v-date-anti').value;

                    this.saveData();
                    this.renderVehicles();
                    document.querySelector('.modal-overlay').remove();
                }
            },

            deleteVehicle(id) {
                if (confirm('Are you sure you want to remove this vehicle?')) {
                    this.vehicles = this.vehicles.filter(v => v.id !== id);
                    this.saveData();
                    this.renderVehicles();
                }
            },

            async updateSoldier(originalId) {
                const name = document.getElementById('edit-sol-name').value;
                const rank = document.getElementById('edit-sol-rank').value;
                // ID is read-only, but we keep the original ID ref
                const category = document.getElementById('edit-sol-category').value;
                const unitBase = document.getElementById('edit-sol-unit').value;
                const campLocation = document.getElementById('edit-sol-camp-location').value;
                const section = document.getElementById('edit-sol-section').value;
                const profession = document.getElementById('edit-sol-profession').value;
                const dutyList = document.getElementById('edit-sol-duty-list').value;

                if (name && rank) {
                    const camps = this.unitsData[unitBase] || [];
                    const finalUnit = camps.length > 0 ? campLocation : unitBase;

                    const index = this.personnel.findIndex(p => p.id === originalId);
                    if (index !== -1) {
                        this.personnel[index] = {
                            ...this.personnel[index],
                            name,
                            rank,
                            category,
                            unit: finalUnit,
                            section,
                            profession,
                            dutyList
                        };

                        // Update assignments if name/rank changed?
                        // It's tricky if name changes, as assignments link by name currently (based on addSoldier/assignPersonnel logic).
                        // Ideally we should link by ID, but the current assignment structure uses name/rank copy.
                        // Let's update assignments that match the OLD name/rank if possible, or just warn.
                        // For now, simple update.

                        await this.saveData();
                        this.renderPersonnel();
                        document.querySelector('.modal-overlay').remove();
                    }
                } else {
                    alert('Please fill all required fields.');
                }
            },

            renderReports() {
                this.contentArea.innerHTML = `
            <div class="dashboard-header">
    <h1>Operational Reports</h1>
    <p>Generate and view tactical deployment reports.</p>
</div>
            <div class="panel">
                <div class="panel-body p-20">
                    <p>No active reports currently. System is gathering data from all sectors.</p>
                    <button class="btn-primary" style="margin-top: 20px;"><i class="fas fa-file-export"></i> Export Nightly
                        Report</button>
                </div>
            </div>
        `;
            },

            renderSettings() {
                this.contentArea.innerHTML = `
            <div class="dashboard-header">
    <h1>Tactical System Settings</h1>
    <p>Configure command data and operational parameters.</p>
</div>

            <div class="settings-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Base Information</h2>
                    </div>
                    <div class="panel-body p-20">
                        <div class="form-group">
                            <label>Base Location</label>
                            <input type="text" value="Dhaka Cantonment" readonly
                                style="background:transparent; border:1px solid #333; color:#fff; padding:10px; width:100%; margin-top:10px;">
                        </div>
                        <div class="form-group" style="margin-top:20px;">
                            <label>Security Level</label>
                            <span style="color:var(--accent-color); margin-left:10px; font-weight:bold;">LEVEL 4 - RESTRICTED</span>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h2>Manage Trades / Professions</h2>
                    </div>
                    <div class="panel-body p-20">
                        <div id="profession-list" style="margin-bottom:15px; max-height: 150px; overflow-y: auto;">
                            ${this.professions.map(p => `
                <div
                    style="display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.05); padding:8px 12px; margin-bottom:5px; border-radius:4px;">
                    <span>${p}</span>
                    <i class="fas fa-times" onclick="app.removeProfession('${p}')"
                        style="color:#e74c3c; cursor:pointer; font-size:0.8rem;"></i>
                </div>
                `).join('')}
                        </div>
                        <div class="form-group" style="display:flex; gap:10px;">
                            <input type="text" id="new-profession-input" placeholder="New Trade Name..."
                                style="flex:1; background:transparent; border:1px solid #333; color:#fff; padding:8px; border-radius:4px;">
                                <button class="btn-primary" onclick="app.addProfession()" style="padding:8px 15px;"><i
                                    class="fas fa-plus"></i></button>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h2>Manage Sections</h2>
                    </div>
                    <div class="panel-body p-20">
                        <div id="section-list" style="margin-bottom:15px; max-height: 150px; overflow-y: auto;">
                            ${this.sections.map(s => `
                <div
                    style="display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.05); padding:8px 12px; margin-bottom:5px; border-radius:4px;">
                    <span>${s}</span>
                    <i class="fas fa-times" onclick="app.removeSection('${s}')"
                        style="color:#e74c3c; cursor:pointer; font-size:0.8rem;"></i>
                </div>
                `).join('')}
                        </div>
                        <div class="form-group" style="display:flex; gap:10px;">
                            <input type="text" id="new-section-input" placeholder="New Section Name..."
                                style="flex:1; background:transparent; border:1px solid #333; color:#fff; padding:8px; border-radius:4px;">
                                <button class="btn-primary" onclick="app.addSection()" style="padding:8px 15px;"><i
                                    class="fas fa-plus"></i></button>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <label style="color:var(--accent-color); font-weight:bold; margin-bottom:10px; display:block;">UNIT & CAMP
                        MANAGEMENT</label>
                    <div id="unit-mgmt-container" style="display:grid; grid-template-columns: 1fr 1.5fr; gap:15px;">
                        <div class="mgmt-column">
                            <h4 style="font-size:0.8rem; margin-bottom:10px; color:var(--text-secondary);">Units</h4>
                            <div id="unit-list" style="max-height: 200px; overflow-y: auto;">
                                ${Object.keys(this.unitsData).map(u => `
                    <div style="display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.05); padding:8px 12px; margin-bottom:5px; border-radius:4px; cursor:pointer; border:1px solid ${this.activeSettingsUnit === u ? 'var(--accent-color)' : 'transparent'}"
                        onclick="app.setActiveSettingsUnit('${u}')">
                        <span style="font-size:0.9rem;">${u}</span>
                        <i class="fas fa-times" onclick="event.stopPropagation(); app.removeUnit('${u}')"
                            style="color:#e74c3c; cursor:pointer; font-size:0.7rem;"></i>
                    </div>
                    `).join('')}
                            </div>
                            <div class="form-group" style="display:flex; gap:5px; margin-top:10px;">
                                <input type="text" id="new-unit-input" placeholder="Unit..."
                                    style="flex:1; background:transparent; border:1px solid #333; color:#fff; padding:6px; border-radius:4px; font-size:0.8rem;">
                                    <button class="btn-primary" onclick="app.addUnit()" style="padding:4px 10px;"><i
                                        class="fas fa-plus"></i></button>
                            </div>
                        </div>
                        <div class="mgmt-column">
                            <h4 style="font-size:0.8rem; margin-bottom:10px; color:var(--text-secondary);">Location/Camps for:
                                ${this.activeSettingsUnit || 'Select Unit'}</h4>
                            <div id="camp-list" style="max-height: 200px; overflow-y: auto;">
                                ${this.activeSettingsUnit && this.unitsData[this.activeSettingsUnit] ?
                        this.unitsData[this.activeSettingsUnit].map(c => `
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.05); padding:8px 12px; margin-bottom:5px; border-radius:4px;">
                        <span style="font-size:0.9rem;">${c}</span>
                        <i class="fas fa-times" onclick="app.removeCamp('${this.activeSettingsUnit}', '${c}')"
                            style="color:#e74c3c; cursor:pointer; font-size:0.7rem;"></i>
                    </div>
                    `).join('') : `<div
                        style="color:var(--text-secondary); font-size:0.8rem; text-align:center; padding-top:20px;">
                    Select a unit to manage camps</div>`}
                            </div>
                            ${this.activeSettingsUnit ? `
                <div class="form-group" style="display:flex; gap:5px; margin-top:10px;">
                    <input type="text" id="new-camp-input" placeholder="Camp Name..."
                        style="flex:1; background:transparent; border:1px solid #333; color:#fff; padding:6px; border-radius:4px; font-size:0.8rem;">
                    <button class="btn-primary" onclick="app.addCamp()" style="padding:4px 10px;"><i
                            class="fas fa-plus"></i></button>
                </div>
                ` : ''
                    }
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h2>Cloud Backup (GitHub)</h2>
                    </div>
                    <div class="panel-body p-20">
                        <div class="form-group">
                            <label>GitHub Personal Access Token (PAT)</label>
                            <input type="password" id="gh-token" placeholder="ghp_..." value="${this.githubToken}"
                                style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); color:#fff; padding:12px 15px; width:100%; border-radius:12px;">
                                <small style="color:#aaa; display:block; margin-top:5px;">Required scope: <code>repo</code></small>
                        </div>
                        <div class="form-group" style="margin-top:15px; display:flex; gap:10px;">
                            <div style="flex:1;">
                                <label>GitHub Username</label>
                                <input type="text" id="gh-owner" placeholder="username" value="${this.githubOwner}"
                                    style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); color:#fff; padding:12px 15px; width:100%; border-radius:12px;">
                            </div>
                            <div style="flex:1;">
                                <label>Repository Name</label>
                                <input type="text" id="gh-repo" placeholder="repo-name" value="${this.githubRepo}"
                                    style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); color:#fff; padding:12px 15px; width:100%; border-radius:12px;">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:15px;">
                            <label>File Path</label>
                            <input type="text" id="gh-path" placeholder="data/army_data.json" value="${this.githubPath}"
                                style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); color:#fff; padding:12px 15px; width:100%; border-radius:12px;">
                        </div>
                        <div class="form-actions" style="margin-top:20px; display:flex; gap:10px;">
                            <button class="btn-primary" onclick="app.saveGithubSettings()"><i class="fas fa-save"></i> Save
                                Settings</button>
                            <button class="btn-primary" style="background:#27ae60;" onclick="app.saveToGitHub()"><i
                                class="fas fa-cloud-upload-alt"></i> Save Data to Cloud</button>
                            <button class="btn-secondary" onclick="app.loadFromGitHub()"><i class="fas fa-cloud-download-alt"></i>
                                Load from Cloud</button>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h2>Data Management</h2>
                    </div>
                    <div class="panel-body p-20">
                        <p style="color:var(--text-secondary); font-size:0.9rem; margin-bottom:15px;">Warning: This will clear all
                            personnel, assignments, and custom settings.</p>
                        <button class="btn-primary" onclick="app.resetSystem()"
                            style="background:#e74c3c; border:none; width:100%;">
                            <i class="fas fa-redo"></i> Factory Reset System
                        </button>
                    </div>
                </div>
            </div>
        `;
            },

            saveGithubSettings() {
                let token = document.getElementById('gh-token').value.trim();
                let owner = document.getElementById('gh-owner').value.trim();
                let repo = document.getElementById('gh-repo').value.trim();
                let path = document.getElementById('gh-path').value.trim();

                // Smart URL handling: If user pastes a full URL into Owner or Repo, try to extract parts.
                // Format: https://github.com/OWNER/REPO/... or https://raw.githubusercontent.com/OWNER/REPO/...

                const extractFromUrl = (input) => {
                    try {
                        const url = new URL(input);
                        const parts = url.pathname.split('/').filter(p => p);
                        // github.com/OWNER/REPO
                        // raw.githubusercontent.com/OWNER/REPO/BRANCH/PATH
                        if (parts.length >= 2) {
                            return { owner: parts[0], repo: parts[1] };
                        }
                    } catch (e) {
                        // Not a URL, return null
                    }
                    return null;
                };

                const ownerUrlParts = extractFromUrl(owner);
                if (ownerUrlParts) {
                    owner = ownerUrlParts.owner;
                    repo = ownerUrlParts.repo; // Assume if they pasted a URL in owner, they meant the whole repo
                }

                const repoUrlParts = extractFromUrl(repo);
                if (repoUrlParts) {
                    owner = repoUrlParts.owner;
                    repo = repoUrlParts.repo;
                }

                if (!token) {
                    alert('Error: GitHub Personal Access Token (PAT) is required to save data! Please generate one at github.com/settings/tokens with "repo" scope.');
                    return;
                }

                if (token && owner && repo) {
                    this.githubToken = token;
                    this.githubOwner = owner;
                    this.githubRepo = repo;
                    this.githubPath = path || 'army_data.json';

                    localStorage.setItem('github_token', this.githubToken);
                    localStorage.setItem('github_owner', this.githubOwner);
                    localStorage.setItem('github_repo', this.githubRepo);
                    localStorage.setItem('github_path', this.githubPath);

                    alert(`Settings Saved! Target: ${this.githubOwner}/${this.githubRepo} File: ${this.githubPath} - You can now use "Save to Cloud" to push data.`);
                    this.renderSettings();
                } else {
                    alert('Please fill in Owner and Repo fields.');
                }
            },
            async saveToGitHub() {
                if (!this.githubToken || !this.githubOwner || !this.githubRepo) {
                    alert('Please configure GitHub settings first!');
                    return;
                }

                const dataToSave = {
                    posts: this.posts,
                    assignments: this.assignments,
                    personnel: this.personnel,
                    professions: this.professions,
                    sections: this.sections,
                    unitsData: this.unitsData
                };

                const content = btoa(unescape(encodeURIComponent(JSON.stringify(dataToSave, null, 2))));
                const url = `https://api.github.com/repos/${this.githubOwner}/${this.githubRepo}/contents/${this.githubPath}`;

                try {
                    // Check for existing file to get SHA
                    const getResponse = await fetch(url, {
                        headers: {
                            'Authorization': `token ${this.githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    let sha = null;
                    if (getResponse.ok) {
                        const getData = await getResponse.json();
                        sha = getData.sha;
                    }

                    const putBody = {
                        message: 'Auto-save from Tactical Dashboard',
                        content: content
                    };
                    if (sha) putBody.sha = sha;

                    const putResponse = await fetch(url, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${this.githubToken}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(putBody)
                    });

                    if (putResponse.ok) {
                        alert('Data successfully saved to GitHub!');
                    } else {
                        const err = await putResponse.json();
                        throw new Error(err.message);
                    }
                } catch (error) {
                    console.error('GitHub Save Error:', error);
                    alert('Failed to save to GitHub: ' + error.message);
                }
            },

            async loadFromGitHub() {
                if (!this.githubToken || !this.githubOwner || !this.githubRepo) {
                    alert('Please configure GitHub settings first!');
                    return;
                }

                const url = `https://api.github.com/repos/${this.githubOwner}/${this.githubRepo}/contents/${this.githubPath}`;

                try {
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `token ${this.githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const content = decodeURIComponent(escape(atob(data.content)));
                        const parsedData = JSON.parse(content);

                        // Update local state
                        this.posts = parsedData.posts || [];
                        this.assignments = parsedData.assignments || [];
                        this.personnel = parsedData.personnel || [];
                        this.professions = parsedData.professions || [];
                        this.sections = parsedData.sections || [];
                        this.unitsData = parsedData.unitsData || {};

                        this.saveData(); // Save to localStorage
                        alert('Data loaded from GitHub successfully!');
                        location.reload(); // Refresh to reflect changes
                    } else {
                        throw new Error('File not found or access denied');
                    }
                } catch (error) {
                    console.error('GitHub Load Error:', error);
                    alert('Failed to load from GitHub: ' + error.message);
                }
            },

            addProfession() {
                const input = document.getElementById('new-profession-input');
                const val = input.value.trim();
                if (val && !this.professions.includes(val)) {
                    this.professions.push(val);
                    this.saveData();
                    this.renderSettings();
                }
            },

            removeProfession(val) {
                if (confirm(`Remove "${val}" from trades? This won't affect existing soldiers.`)) {
                    this.professions = this.professions.filter(p => p !== val);
                    this.saveData();
                    this.renderSettings();
                }
            },

            addSection() {
                const input = document.getElementById('new-section-input');
                const val = input.value.trim();
                if (val && !this.sections.includes(val)) {
                    this.sections.push(val);
                    this.saveData();
                    this.renderSettings();
                }
            },

            removeSection(val) {
                if (confirm(`Remove "${val}" from sections? This won't affect existing soldiers.`)) {
                    this.sections = this.sections.filter(s => s !== val);
                    this.saveData();
                    this.renderSettings();
                }
            },

            async resetSystem() {
                if (confirm('CRITICAL ACTION: Are you sure you want to wipe all tactical data? This cannot be undone.')) {
                    // Reset to defaults
                    this.posts = [];
                    this.assignments = [];
                    this.personnel = [];
                    this.professions = ["Technician", "Operator", "Driver Signal", "Clerk", "SMT Clerk"];
                    this.sections = ["BHQ COY", "HQ COY", "RDO COY", "RR COY", "OP COY", "108 COY", "109 COY", "RP", "MT"];
                    this.unitsData = { "9 SIG BN": [], "Army Camp": ["Narsindi Camp", "Sippur Camp"] };

                    await this.saveData();
                    location.reload();
                }
            },

            setActiveSettingsUnit(unit) {
                this.activeSettingsUnit = unit;
                this.renderSettings();
            },

            addUnit() {
                const input = document.getElementById('new-unit-input');
                const val = input.value.trim();
                if (val && !this.unitsData[val]) {
                    this.unitsData[val] = [];
                    this.saveData();
                    this.renderSettings();
                }
            },

            removeUnit(unit) {
                if (confirm(`Remove unit "${unit}" and all its camps?`)) {
                    delete this.unitsData[unit];
                    if (this.activeSettingsUnit === unit) this.activeSettingsUnit = null;
                    this.saveData();
                    this.renderSettings();
                }
            },

            addCamp() {
                const input = document.getElementById('new-camp-input');
                const val = input.value.trim();
                if (val && this.activeSettingsUnit && !this.unitsData[this.activeSettingsUnit].includes(val)) {
                    this.unitsData[this.activeSettingsUnit].push(val);
                    this.saveData();
                    this.renderSettings();
                }
            },

            removeCamp(unit, camp) {
                if (confirm(`Remove location "${camp}" from ${unit}?`)) {
                    this.unitsData[unit] = this.unitsData[unit].filter(c => c !== camp);
                    this.saveData();
                    this.renderSettings();
                }
            },

            setPersonnelFilter(filter) {
                this.currentPersonnelFilter = filter;
                this.renderPersonnel();
            },

            setRegistryFilter(key, value) {
                this[key] = value;
                if (key === 'currentDutyCategory') {
                    this.renderDutyPosts();
                } else if (key.toLowerCase().includes('vehicle')) {
                    this.renderVehicles();
                } else {
                    this.renderPersonnel();
                }
            },

            resetFilters() {
                this.currentPersonnelFilter = 'All';
                this.currentUnitFilter = 'All';
                this.currentRankFilter = 'All';
                this.currentDutyFilter = 'All';
                this.renderPersonnel();
            },

            setPersonnelViewMode(mode) {
                this.personnelViewMode = mode;
                this.renderPersonnel();
            },

            renderDashboard() {
                this.contentArea.innerHTML = `
<div class="dashboard-header">
    <h1>Tactical Overview</h1>
    <p>Real-time status of all active units and assignments.</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-users"></i></div>
        <div class="stat-info">
            <h3>Total Personnel</h3>
            <div class="value">${this.personnel.length}</div>
        </div>
    </div>
    <div class="stat-card active-duty">
        <div class="stat-icon"><i class="fas fa-crosshairs"></i></div>
        <div class="stat-info">
            <h3>Active Duty</h3>
            <div class="value">${this.assignments.length}</div>
        </div>
    </div>
    <div class="stat-card standby">
        <div class="stat-icon"><i class="fas fa-clock"></i></div>
        <div class="stat-info">
            <h3>Standby</h3>
            <div class="value">${Math.max(0, this.personnel.length - this.assignments.length)}</div>
        </div>
    </div>
    <div class="stat-card leave">
        <div class="stat-icon"><i class="fas fa-truck-pickup"></i></div>
        <div class="stat-info">
            <h3>Vehicles</h3>
            <div class="value">${this.vehicles.length}</div>
        </div>
    </div>
</div>

<div class="stats-grid" style="margin-top: -15px; grid-template-columns: repeat(4, 1fr); gap: 15px;">
    <div style="background:rgba(255,255,255,0.03); padding:10px; border-radius:8px; text-align:center; border:1px solid rgba(255,255,255,0.05);">
        <div style="font-size:0.7rem; color:var(--text-secondary); text-transform:uppercase;">Jeep</div>
        <div style="font-size:1.2rem; font-weight:bold; color:var(--accent-color);">${this.vehicles.filter(v => v.type === 'Jeep').length}</div>
    </div>
    <div style="background:rgba(255,255,255,0.03); padding:10px; border-radius:8px; text-align:center; border:1px solid rgba(255,255,255,0.05);">
        <div style="font-size:0.7rem; color:var(--text-secondary); text-transform:uppercase;">Pickup</div>
        <div style="font-size:1.2rem; font-weight:bold; color:var(--accent-color);">${this.vehicles.filter(v => v.type === 'Pickup').length}</div>
    </div>
    <div style="background:rgba(255,255,255,0.03); padding:10px; border-radius:8px; text-align:center; border:1px solid rgba(255,255,255,0.05);">
        <div style="font-size:0.7rem; color:var(--text-secondary); text-transform:uppercase;">3-Ton</div>
        <div style="font-size:1.2rem; font-weight:bold; color:var(--accent-color);">${this.vehicles.filter(v => v.type === '3-Ton').length}</div>
    </div>
    <div style="background:rgba(255,255,255,0.03); padding:10px; border-radius:8px; text-align:center; border:1px solid rgba(255,255,255,0.05);">
        <div style="font-size:0.7rem; color:var(--text-secondary); text-transform:uppercase;">Motorcycle</div>
        <div style="font-size:1.2rem; font-weight:bold; color:var(--accent-color);">${this.vehicles.filter(v => v.type === 'Motorcycle').length}</div>
    </div>
</div>

<div class="dashboard-content">
    <div class="panel recent-duty">
        <div class="panel-header">
            <h2>Recent Duty Assignments</h2>
            <button class="btn-link">View All</button>
        </div>
        <div class="panel-body">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Personnel</th>
                        <th>Assignment</th>
                        <th>Status</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    ${this.assignments.slice(-5).reverse().map(a => `
                    <tr>
                        <td>${a.personnelRank} ${a.personnelName}</td>
                        <td>${this.posts.find(p => p.id === a.postId)?.name || 'Unknown Post'}</td>
                        <td><span class="status-badge active">Ongoing</span></td>
                        <td>${new Date().getHours()}:00 - ${(new Date().getHours() + 8) % 24}:00</td>
                    </tr>
                    `).join('')}
                    ${this.assignments.length === 0 ? `<tr>
                        <td colspan="4" style="text-align:center; color:var(--text-secondary);">No active assignments
                            found</td>
                    </tr>` : ''}
                </tbody>
            </table>
        </div>
    </div>

            <div class="panel alert-panel">
                <div class="panel-header">
                    <h2>System Alerts</h2>
                </div>
                <div class="panel-body">
                    <div class="alert-item high">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="alert-content">
                            <strong>Logistics Delay</strong>
                            <p>Sect-4 Supply chain delayed by 2 hours.</p>
                        </div>
                    </div>
                    <div class="alert-item mid">
                        <i class="fas fa-info-circle"></i>
                        <div class="alert-content">
                            <strong>Shift Update</strong>
                            <p>Evening shift for Alpha Squad rescheduled.</p>
                        </div>
                    </div>
                </div>
            </div>
</div>
            `;
            },

            renderRoster() {
                this.contentArea.innerHTML = `
            <div class="dashboard-header">
    <h1>Deployment Roster</h1>
    <div class="actions">
        <button class="btn-primary"
            onclick="app.handleTabSwitch({currentTarget: document.querySelector('[data-tab=posts]')})"><i
                class="fas fa-plus"></i> New Assignment</button>
    </div>
</div>
            <div class="panel">
                <div class="panel-header">
                    <h2>Active Schedule</h2>
                </div>
                <div class="panel-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Soldier No</th>
                                <th>Name</th>
                                <th>Post</th>
                                <th>Duration</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${this.assignments.map(a => {
                    const soldier = this.personnel.find(p => p.name === a.personnelName);
                    return `
                <tr>
                    <td>${soldier ? soldier.id : 'N/A'}</td>
                    <td>${a.personnelRank} ${a.personnelName}</td>
                    <td>${this.posts.find(p => p.id === a.postId)?.name || 'Unknown'}</td>
                    <td><span style="color:var(--accent-color);">${a.shift || '08:00 - 16:00'}</span></td>
                    <td><span class="status-badge active">On Duty</span></td>
                </tr>
                `;
                }).join('')}
                            ${this.assignments.length === 0 ? `<tr>
                                <td colspan="5" style="text-align:center; color:var(--text-secondary); padding: 20px;">No personnel currently on duty</td>
                    </tr>` : ''}
                </tbody>
            </table>
    </div>
</div>
            `;
            },

            renderPersonnel() {
                const uniqueRanks = [...new Set(this.personnel.map(p => p.rank))].sort();
                const allPossibleUnits = ["9 SIG BN", ...Object.values(this.unitsData).flat()];

                // Filter Logic
                const filteredPersonnel = this.personnel.filter(p => {
                    const matchSearch = !this.personnelSearchQuery ||
                        (p.name.toLowerCase().includes(this.personnelSearchQuery.toLowerCase()) ||
                            p.id.toLowerCase().includes(this.personnelSearchQuery.toLowerCase()));
                    const matchCategory = this.currentPersonnelFilter === 'All' || p.category === this.currentPersonnelFilter;
                    const matchUnit = this.currentUnitFilter === 'All' || (p.unit || '9 SIG BN') === this.currentUnitFilter;
                    const matchRank = this.currentRankFilter === 'All' || p.rank === this.currentRankFilter;
                    const matchDuty = this.currentDutyFilter === 'All' || p.dutyList === this.currentDutyFilter;
                    return matchSearch && matchCategory && matchUnit && matchRank && matchDuty;
                });

                let contentHtml = '';

                if (this.personnelViewMode === 'list') {
                    contentHtml = `
            <table class="data-table">
    <thead>
        <tr>
            <th>Soldier No</th>
            <th>Rank</th>
            <th>Trade</th>
            <th>Name</th>
            <th>Section</th>
            <th>Unit/Camp</th>
            <th>Duty List</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        ${filteredPersonnel.map(p => `
        <tr>
            <td style="font-family: 'Orbitron', sans-serif; font-size:0.8rem;">${p.id}</td>
            <td><span style="color:var(--accent-color); font-weight:500;">${p.rank}</span></td>
            <td style="font-size: 0.85rem; color: var(--text-secondary);">${p.profession || 'N/A'}</td>
            <td>${p.name}</td>
            <td style="font-size: 0.85rem;">${p.section || 'N/A'}</td>
            <td style="font-size: 0.85rem; color: var(--accent-color);">${p.unit || '9 SIG BN'}</td>
            <td><span class="status-badge ${p.dutyList === 'On' ? 'active' : 'completed'}">${p.dutyList === 'On' ? 'In List' : 'Excluded'}</span></td>
            <td><span class="status-badge ${this.assignments.some(a => a.personnelName === p.name) ? 'active' : 'completed'}">${this.assignments.some(a => a.personnelName === p.name) ? 'On Duty' : 'Ready'}</span></td>
            <td>
                <i class="fas fa-eye view-person" data-id="${p.id}" style="color:#3498db; cursor:pointer; margin-right:10px;" title="View Profile"></i>
                <i class="fas fa-edit edit-person" data-id="${p.id}" style="color:var(--accent-color); cursor:pointer; margin-right:10px;" title="Edit Details"></i>
                <i class="fas fa-trash-alt delete-person" data-id="${p.id}" style="color:#e74c3c; cursor:pointer;" title="Remove Soldier"></i>
            </td>
        </tr>
            `).join('')}
    </tbody>
</table>`;
                } else {
                    contentHtml = `<div class="personnel-grid">
    ${filteredPersonnel.map(p => `
    <div class="personnel-card">
        <img src="https://ui-avatars.com/api/?name=${p.name}&background=d4af37&color=000&size=128" class="card-avatar"
            alt="Avatar">
        <div class="card-rank">${p.rank}</div>
        <div class="card-name">${p.name}</div>

        <div class="card-info">
            <div class="info-row">
                <span class="info-label">ID:</span>
                <span style="font-family: 'Orbitron', sans-serif;">${p.id}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Unit:</span>
                <span>${p.unit || '9 SIG BN'}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Trade:</span>
                <span>${p.profession || 'N/A'}</span>
            </div>
        </div>

        <div style="margin-bottom: 15px;">
            <span
                class="status-badge ${this.assignments.some(a => a.personnelName === p.name) ? 'active' : 'completed'}">
                ${this.assignments.some(a => a.personnelName === p.name) ? 'On Duty' : 'Ready'}
            </span>
        </div>

        <div class="card-actions">
            <i class="fas fa-eye view-person" data-id="${p.id}"
                style="color:#3498db; cursor:pointer; font-size: 1.1rem;" title="View Profile"></i>
            <i class="fas fa-edit edit-person" data-id="${p.id}"
                style="color:var(--accent-color); cursor:pointer; font-size: 1.1rem;" title="Edit Details"></i>
            <i class="fas fa-trash-alt delete-person" data-id="${p.id}"
                style="color:#e74c3c; cursor:pointer; font-size: 1.1rem;" title="Remove Soldier"></i>
        </div>
    </div>
    `).join('')}
</div>`;
                }

                this.contentArea.innerHTML = `
<div class="dashboard-header" style="display:flex; justify-content:space-between; align-items:center;">
    <div>
        <h1>Personnel Registry</h1>
        <p>Register and manage all military personnel records.</p>
    </div>
    <div style="display:flex; align-items:center; gap: 15px;">
        <div class="view-toggles"
            style="display:flex; gap:5px; background:rgba(255,255,255,0.05); padding:4px; border-radius:8px; border: 1px solid var(--border-color);">
            <button class="view-mode-btn ${this.personnelViewMode === 'list' ? 'active' : ''}"
                onclick="app.setPersonnelViewMode('list')" title="List View"><i class="fas fa-list"></i></button>
            <button class="view-mode-btn ${this.personnelViewMode === 'grid' ? 'active' : ''}"
                onclick="app.setPersonnelViewMode('grid')" title="Grid View"><i class="fas fa-th-large"></i></button>
        </div>
        <button class="btn-primary" onclick="app.showAddSoldierModal()"><i class="fas fa-user-plus"></i> Add
            Soldier</button>
    </div>
</div>

<div class="filter-bar"
    style="display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; background:rgba(255,255,255,0.02); padding:15px; border-radius:8px; border:1px solid rgba(255,255,255,0.05);">
    <div class="filter-item">
        <label style="display:block; font-size:0.7rem; color:var(--text-secondary); margin-bottom:5px;">CATEGORY</label>
        <select onchange="app.setRegistryFilter('currentPersonnelFilter', this.value)"
            style="background:var(--secondary-bg); border:1px solid #444; color:#fff; padding:8px 12px; border-radius:4px; font-size:0.75rem; width:180px;">
            <option value="All" ${this.currentPersonnelFilter === 'All' ? 'selected' : ''}>All Categories</option>
            <option value="Officer (Class 1 Gazetted Officer)"
                ${this.currentPersonnelFilter === 'Officer (Class 1 Gazetted Officer)' ? 'selected' : ''}>Officers
            </option>
            <option value="Junior Commissioned Officer (JCO)"
                ${this.currentPersonnelFilter === 'Junior Commissioned Officer (JCO)' ? 'selected' : ''}>JCOs</option>
            <option value="NCOs/Soldiers" ${this.currentPersonnelFilter === 'NCOs/Soldiers' ? 'selected' : ''}>
                NCOs/Soldiers</option>
        </select>
    </div>

    <div class="filter-item">
        <label
            style="display:block; font-size:0.7rem; color:var(--text-secondary); margin-bottom:5px;">UNIT/CAMP</label>
        <select onchange="app.setRegistryFilter('currentUnitFilter', this.value)"
            style="background:var(--secondary-bg); border:1px solid #444; color:#fff; padding:8px 12px; border-radius:4px; font-size:0.75rem; width:150px;">
            <option value="All" ${this.currentUnitFilter === 'All' ? 'selected' : ''}>All Units</option>
            ${allPossibleUnits.map(u => `<option value="${u}" ${this.currentUnitFilter === u ? 'selected' : ''}>${u}
            </option>`).join('')}
        </select>
    </div>

    <div class="filter-item">
        <label style="display:block; font-size:0.7rem; color:var(--text-secondary); margin-bottom:5px;">RANK</label>
        <select onchange="app.setRegistryFilter('currentRankFilter', this.value)"
            style="background:var(--secondary-bg); border:1px solid #444; color:#fff; padding:8px 12px; border-radius:4px; font-size:0.75rem; width:150px;">
            <option value="All" ${this.currentRankFilter === 'All' ? 'selected' : ''}>All Ranks</option>
            ${uniqueRanks.map(r => `<option value="${r}" ${this.currentRankFilter === r ? 'selected' : ''}>${r}</option>
            `).join('')}
        </select>
    </div>

    <div class="filter-item">
        <label style="display:block; font-size:0.7rem; color:var(--text-secondary); margin-bottom:5px;">DUTY
            LIST</label>
        <select onchange="app.setRegistryFilter('currentDutyFilter', this.value)"
            style="background:var(--secondary-bg); border:1px solid #444; color:#fff; padding:8px 12px; border-radius:4px; font-size:0.75rem; width:120px;">
            <option value="All" ${this.currentDutyFilter === 'All' ? 'selected' : ''}>All Status</option>
            <option value="On" ${this.currentDutyFilter === 'On' ? 'selected' : ''}>In List (On)</option>
            <option value="Off" ${this.currentDutyFilter === 'Off' ? 'selected' : ''}>Excluded (Off)</option>
        </select>
        <div class="filter-item" style="display:flex; align-items:flex-end;">
            <button onclick="app.resetFilters()"
                style="background:#e74c3c; border:none; color:#fff; padding:8px 15px; border-radius:4px; font-size:0.75rem; cursor:pointer; height:36px; display:flex; align-items:center; gap:5px;">
                <i class="fas fa-undo"></i> Reset Filters
            </button>
        </div>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card ${this.currentPersonnelFilter === 'Officer (Class 1 Gazetted Officer)' ? 'active-filter' : ''}"
        onclick="app.setRegistryFilter('currentPersonnelFilter', 'Officer (Class 1 Gazetted Officer)')"
        style="cursor:pointer; transition: transform 0.2s;">
        <div class="stat-info">
            <h3>Officers</h3>
            <div class="value">${this.personnel.filter(p => p.category === "Officer (Class 1 Gazetted Officer)").length}
            </div>
        </div>
    </div>
    <div class="stat-card ${this.currentPersonnelFilter === 'Junior Commissioned Officer (JCO)' ? 'active-filter' : ''}"
        onclick="app.setRegistryFilter('currentPersonnelFilter', 'Junior Commissioned Officer (JCO)')"
        style="cursor:pointer; transition: transform 0.2s;">
        <div class="stat-info">
            <h3>JCOs</h3>
            <div class="value">${this.personnel.filter(p => p.category === "Junior Commissioned Officer (JCO)").length}
            </div>
        </div>
    </div>
    <div class="stat-card ${this.currentPersonnelFilter === 'NCOs/Soldiers' ? 'active-filter' : ''}"
        onclick="app.setRegistryFilter('currentPersonnelFilter', 'NCOs/Soldiers')"
        style="cursor:pointer; transition: transform 0.2s;">
        <div class="stat-info">
            <h3>NCOs/Soldiers</h3>
            <div class="value">${this.personnel.filter(p => p.category === "NCOs/Soldiers").length}</div>
        </div>
    </div>
</div>
<div class="panel" style="${this.personnelViewMode === 'grid' ? 'background:transparent; border:none;' : ''}">
    <div class="panel-body" style="${this.personnelViewMode === 'grid' ? 'padding:0;' : ''}">
        ${contentHtml}
    </div>
</div>
`;
            }
        };
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            try {
                if (typeof app === 'undefined') {
                    throw new Error("App object is not defined. Possible syntax error in script.");
                }
                app.init();
            } catch (error) {
                console.error("Initialization Error:", error);
                alert("Critical System Error: " + error.message);
                const loader = document.querySelector('.dashboard-loading');
                if (loader) loader.textContent = "System Error: " + error.message;
            }
        });
    </script>
</body>

</html>
